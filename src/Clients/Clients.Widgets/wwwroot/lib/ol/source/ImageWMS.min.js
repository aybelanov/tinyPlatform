/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/source/ImageWMS.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import ImageSource,{defaultImageLoadFunction}from"./Image.js";import{DECIMALS}from"./common.js";import{DEFAULT_VERSION,createLoader,getRequestParams,getRequestUrl}from"./wms.js";import{appendParams}from"../uri.js";import{calculateSourceResolution}from"../reproj.js";import{compareVersions}from"../string.js";import{decode}from"../Image.js";import{floor}from"../math.js";import{getForViewAndSize}from"../extent.js";import{get as getProjection,transform}from"../proj.js";const GETFEATUREINFO_IMAGE_SIZE=[101,101];class ImageWMS extends ImageSource{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:defaultImageLoadFunction,this.params_=e.params,this.serverType_=e.serverType,this.hidpi_=void 0===e.hidpi||e.hidpi,this.renderedRevision_=0,this.ratio_=void 0!==e.ratio?e.ratio:1.5}getFeatureInfoUrl(e,t,r,i){if(void 0===this.url_)return;const o=getProjection(r),s=this.getProjection();s&&s!==o&&(t=calculateSourceResolution(s,o,e,t),e=transform(e,o,s));const a=getForViewAndSize(e,t,0,GETFEATUREINFO_IMAGE_SIZE),n={QUERY_LAYERS:this.params_.LAYERS};Object.assign(n,getRequestParams(this.params_,"GetFeatureInfo"),i);const m=floor((e[0]-a[0])/t,DECIMALS),u=floor((a[3]-e[1])/t,DECIMALS),g=compareVersions(n.VERSION,"1.3")>=0;return n[g?"I":"X"]=m,n[g?"J":"Y"]=u,getRequestUrl(this.url_,a,GETFEATUREINFO_IMAGE_SIZE,s||o,n)}getLegendUrl(e,t){if(void 0===this.url_)return;const r={SERVICE:"WMS",VERSION:DEFAULT_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===t||void 0===t.LAYER){const e=this.params_.LAYERS;if(!(!Array.isArray(e)||1===e.length))return;r.LAYER=e}if(void 0!==e){const t=this.getProjection()?this.getProjection().getMetersPerUnit():1,i=28e-5;r.SCALE=e*t/i}return Object.assign(r,t),appendParams(this.url_,r)}getParams(){return this.params_}getImageInternal(e,t,r,i){return void 0===this.url_?null:(this.loader||(this.loader=createLoader({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(e,t)=>(this.image.setImage(e),this.imageLoadFunction_(this.image,t),decode(e))})),super.getImageInternal(e,t,r,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}export default ImageWMS;
//# sourceMappingURL=/sm/a022504d50bd6f251749d3ad0aa0038f7bd1a77628a846b489a30d59d0eb0831.map