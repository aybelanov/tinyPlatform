/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/source/BingMaps.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import TileImage from"./TileImage.js";import{applyTransform,intersects}from"../extent.js";import{createFromTileUrlFunctions}from"../tileurlfunction.js";import{createOrUpdate}from"../tilecoord.js";import{createXYZ,extentFromProjection}from"../tilegrid.js";import{get as getProjection,getTransformFromProjections}from"../proj.js";export function quadKey(e){const t=e[0],r=new Array(t);let i,o,s=1<<t-1;for(i=0;i<t;++i)o=48,e[1]&s&&(o+=1),e[2]&s&&(o+=2),r[i]=String.fromCharCode(o),s>>=1;return r.join("")}const TOS_ATTRIBUTION='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class BingMaps extends TileImage{constructor(e){const t=void 0!==e.hidpi&&e.hidpi;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:!0,projection:getProjection("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=void 0!==e.culture?e.culture:"en-us",this.maxZoom_=void 0!==e.maxZoom?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const r="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(r).then((e=>e.json())).then((e=>this.handleImageryMetadataResponse(e)))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(200!=e.statusCode||"OK"!=e.statusDescription||"ValidCredentials"!=e.authenticationResultCode||1!=e.resourceSets.length||1!=e.resourceSets[0].resources.length)return void this.setState("error");const t=e.resourceSets[0].resources[0],r=-1==this.maxZoom_?t.zoomMax:this.maxZoom_,i=this.getProjection(),o=extentFromProjection(i),s=this.hidpi_?2:1,a=t.imageWidth==t.imageHeight?t.imageWidth/s:[t.imageWidth/s,t.imageHeight/s],n=createXYZ({extent:o,minZoom:t.zoomMin,maxZoom:r,tileSize:a});this.tileGrid=n;const c=this.culture_,m=this.hidpi_,l=this.placeholderTiles_;if(this.tileUrlFunction=createFromTileUrlFunctions(t.imageUrlSubdomains.map((function(e){const r=[0,0,0],i=t.imageUrl.replace("{subdomain}",e).replace("{culture}",c);return function(e,t,o){if(!e)return;createOrUpdate(e[0],e[1],e[2],r);const s=new URL(i.replace("{quadkey}",quadKey(r))),a=s.searchParams;return m&&(a.set("dpi","d1"),a.set("device","mobile")),!0===l?a.delete("n"):!1===l&&a.set("n","z"),s.toString()}}))),t.imageryProviders){const e=getTransformFromProjections(getProjection("EPSG:4326"),this.getProjection());this.setAttributions((r=>{const i=[],o=r.viewState,s=this.getTileGrid(),a=s.getZForResolution(o.resolution,this.zDirection),n=s.getTileCoordForCoordAndZ(o.center,a)[0];return t.imageryProviders.map((function(t){let o=!1;const s=t.coverageAreas;for(let t=0,i=s.length;t<i;++t){const i=s[t];if(n>=i.zoomMin&&n<=i.zoomMax){const t=i.bbox,s=[t[1],t[0],t[3],t[2]],a=applyTransform(s,e);if(intersects(a,r.extent)){o=!0;break}}}o&&i.push(t.attribution)})),i.push(TOS_ATTRIBUTION),i}))}this.setState("ready")}}export default BingMaps;
//# sourceMappingURL=/sm/137b2836df45cd15f134019f79f77a450f29cc1e8f92b6c8c67136cb982ecde3.map