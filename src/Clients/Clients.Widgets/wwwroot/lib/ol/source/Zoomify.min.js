/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/source/Zoomify.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{DEFAULT_TILE_SIZE}from"../tilegrid/common.js";import ImageTile from"../ImageTile.js";import TileGrid from"../tilegrid/TileGrid.js";import TileImage from"./TileImage.js";import TileState from"../TileState.js";import{createCanvasContext2D}from"../dom.js";import{createFromTileUrlFunctions,expandUrl}from"../tileurlfunction.js";import{getCenter}from"../extent.js";import{toSize}from"../size.js";export class CustomTile extends ImageTile{constructor(e,t,i,r,o,n,l){super(t,i,r,o,n,l),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==TileState.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const i=createCanvasContext2D(t[0],t[1]);return i.drawImage(e,0,0),this.zoomifyImage_=i.canvas,i.canvas}return e}}class Zoomify extends TileImage{constructor(e){const t=e.size,i=void 0!==e.tierSizeCalculation?e.tierSizeCalculation:"default",r=e.tilePixelRatio||1,o=t[0],n=t[1],l=[],s=e.tileSize||DEFAULT_TILE_SIZE;let a=s*r;switch(i){case"default":for(;o>a||n>a;)l.push([Math.ceil(o/a),Math.ceil(n/a)]),a+=a;break;case"truncated":let e=o,t=n;for(;e>a||t>a;)l.push([Math.ceil(e/a),Math.ceil(t/a)]),e>>=1,t>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}l.push([1,1]),l.reverse();const c=[r],u=[0];for(let e=1,t=l.length;e<t;e++)c.push(r<<e),u.push(l[e-1][0]*l[e-1][1]+u[e-1]);c.reverse();const m=new TileGrid({tileSize:s,extent:e.extent||[0,-n,o,0],resolutions:c});let p=e.url;!p||p.includes("{TileGroup}")||p.includes("{tileIndex}")||(p+="{TileGroup}/{z}-{x}-{y}.jpg");const d=expandUrl(p);let h=s*r;const f=createFromTileUrlFunctions(d.map((function(e){return function(t,i,r){if(!t)return;const o=t[0],n=t[1],s=t[2],a=n+s*l[o][0],c={z:o,x:n,y:s,tileIndex:a,TileGroup:"TileGroup"+((a+u[o])/h|0)};return e.replace(/\{(\w+?)\}/g,(function(e,t){return c[t]}))}}))),g=CustomTile.bind(null,toSize(s*r));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:r,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:g,tileGrid:m,tileUrlFunction:f,transition:e.transition}),this.zDirection=e.zDirection;const T=f(m.getTileCoordForCoordAndResolution(getCenter(m.getExtent()),c[c.length-1]),1,null),z=new Image;z.addEventListener("error",(()=>{h=s,this.changed()})),z.src=T}}export default Zoomify;
//# sourceMappingURL=/sm/effac8dcba4b8165a31a447c8a504179497ee93c18f3fa94edfd057c5bd1ba64.map