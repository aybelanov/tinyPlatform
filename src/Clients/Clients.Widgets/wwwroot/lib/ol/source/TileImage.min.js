/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/source/TileImage.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import EventType from"../events/EventType.js";import ImageTile from"../ImageTile.js";import ReprojTile from"../reproj/Tile.js";import TileCache from"../TileCache.js";import TileState from"../TileState.js";import UrlTile from"./UrlTile.js";import{equivalent,get as getProjection}from"../proj.js";import{getKey,getKeyZXY}from"../tilecoord.js";import{getForProjection as getTileGridForProjection}from"../tilegrid.js";import{getUid}from"../util.js";class TileImage extends UrlTile{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:void 0===e.interpolate||e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,this.tileClass=void 0!==e.tileClass?e.tileClass:ImageTile,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const e in this.tileCacheForProjection){const r=this.tileCacheForProjection[e];r.expireCache(r==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!equivalent(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return!(this.getProjection()&&e&&!equivalent(this.getProjection(),e))&&super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||equivalent(t,e)))return this.tileGrid;const i=getUid(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=getTileGridForProjection(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||equivalent(t,e))return this.tileCache;const i=getUid(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new TileCache(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,r,o,n){const s=[e,t,i],l=this.getTileCoordForTileUrlFunction(s,o),c=l?this.tileUrlFunction(l,r,o):void 0,a=new this.tileClass(s,void 0!==c?TileState.IDLE:TileState.EMPTY,void 0!==c?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return a.key=n,a.addEventListener(EventType.CHANGE,this.handleTileChange.bind(this)),a}getTile(e,t,i,r,o){const n=this.getProjection();if(!n||!o||equivalent(n,o))return this.getTileInternal(e,t,i,r,n||o);const s=this.getTileCacheForProjection(o),l=[e,t,i];let c;const a=getKey(l);s.containsKey(a)&&(c=s.get(a));const h=this.getKey();if(c&&c.key==h)return c;const g=this.getTileGridForProjection(n),j=this.getTileGridForProjection(o),u=this.getTileCoordForTileUrlFunction(l,o),d=new ReprojTile(n,g,o,j,l,u,this.getTilePixelRatio(r),this.getGutter(),((e,t,i,r)=>this.getTileInternal(e,t,i,r,n)),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return d.key=h,c?(d.interimTile=c,d.refreshInterimChain(),s.replace(a,d)):s.set(a,d),d}getTileInternal(e,t,i,r,o){let n=null;const s=getKeyZXY(e,t,i),l=this.getKey();if(this.tileCache.containsKey(s)){if(n=this.tileCache.get(s),n.key!=l){const c=n;n=this.createTile_(e,t,i,r,o,l),c.getState()==TileState.IDLE?n.interimTile=c.interimTile:n.interimTile=c,n.refreshInterimChain(),this.tileCache.replace(s,n)}}else n=this.createTile_(e,t,i,r,o,l),this.tileCache.set(s,n);return n}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(e,t){const i=getProjection(e);if(i){const e=getUid(i);e in this.tileGridForProjection||(this.tileGridForProjection[e]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function defaultTileLoadFunction(e,t){e.getImage().src=t}export default TileImage;
//# sourceMappingURL=/sm/1a20189bda697efad7da8e5cbb3e7196490b97973ee95b79f01cd745ff7cc8fa.map