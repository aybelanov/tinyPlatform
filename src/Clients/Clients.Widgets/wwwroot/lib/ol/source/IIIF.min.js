/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/source/IIIF.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import TileGrid from"../tilegrid/TileGrid.js";import TileImage from"./TileImage.js";import{CustomTile}from"./Zoomify.js";import{DEFAULT_TILE_SIZE}from"../tilegrid/common.js";import{Versions}from"../format/IIIFInfo.js";import{assert}from"../asserts.js";import{getTopLeft}from"../extent.js";import{toSize}from"../size.js";function formatPercentage(e){return e.toLocaleString("en",{maximumFractionDigits:10})}class IIIF extends TileImage{constructor(e){const t=e||{};let i=t.url||"";i+=i.lastIndexOf("/")===i.length-1||""===i?"":"/";const r=t.version||Versions.VERSION2,s=t.sizes||[],o=t.size;assert(null!=o&&Array.isArray(o)&&2==o.length&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const n=o[0],l=o[1],a=t.tileSize,c=t.tilePixelRatio||1,u=t.format||"jpg",f=t.quality||(t.version==Versions.VERSION1?"native":"default");let m=t.resolutions||[];const g=t.supports||[],h=t.extent||[0,-l,n,0],p=null!=s&&Array.isArray(s)&&s.length>0,d=void 0!==a&&("number"==typeof a&&Number.isInteger(a)&&a>0||Array.isArray(a)&&a.length>0),I=null!=g&&Array.isArray(g)&&(g.includes("regionByPx")||g.includes("regionByPct"))&&(g.includes("sizeByWh")||g.includes("sizeByH")||g.includes("sizeByW")||g.includes("sizeByPct"));let y,z,N;if(m.sort((function(e,t){return t-e})),d||I)if(null!=a&&("number"==typeof a&&Number.isInteger(a)&&a>0?(y=a,z=a):Array.isArray(a)&&a.length>0&&((1==a.length||null==a[1]&&Number.isInteger(a[0]))&&(y=a[0],z=a[0]),2==a.length&&(Number.isInteger(a[0])&&Number.isInteger(a[1])?(y=a[0],z=a[1]):null==a[0]&&Number.isInteger(a[1])&&(y=a[1],z=a[1])))),void 0!==y&&void 0!==z||(y=DEFAULT_TILE_SIZE,z=DEFAULT_TILE_SIZE),0==m.length){N=Math.max(Math.ceil(Math.log(n/y)/Math.LN2),Math.ceil(Math.log(l/z)/Math.LN2));for(let e=N;e>=0;e--)m.push(Math.pow(2,e))}else{const e=Math.max(...m);N=Math.round(Math.log(e)/Math.LN2)}else if(y=n,z=l,m=[],p){s.sort((function(e,t){return e[0]-t[0]})),N=-1;const e=[];for(let t=0;t<s.length;t++){const i=n/s[t][0];m.length>0&&m[m.length-1]==i?e.push(t):(m.push(i),N++)}if(e.length>0)for(let t=0;t<e.length;t++)s.splice(e[t]-t,1)}else m.push(1),s.push([n,l]),N=0;const T=new TileGrid({tileSize:[y,z],extent:h,origin:getTopLeft(h),resolutions:m}),M=CustomTile.bind(null,toSize(a||256).map((function(e){return e*c})));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:M,tileGrid:T,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:function(e,t,o){let a,c;const h=e[0];if(h>N)return;const T=e[1],M=e[2],x=m[h];if(!(void 0===T||void 0===M||void 0===x||T<0||Math.ceil(n/x/y)<=T||M<0||Math.ceil(l/x/z)<=M)){if(I||d){const e=T*y*x,t=M*z*x;let i=y*x,s=z*x,o=y,u=z;if(e+i>n&&(i=n-e),t+s>l&&(s=l-t),e+y*x>n&&(o=Math.floor((n-e+x-1)/x)),t+z*x>l&&(u=Math.floor((l-t+x-1)/x)),0==e&&i==n&&0==t&&s==l)a="full";else if(!I||g.includes("regionByPx"))a=e+","+t+","+i+","+s;else if(g.includes("regionByPct")){a="pct:"+formatPercentage(e/n*100)+","+formatPercentage(t/l*100)+","+formatPercentage(i/n*100)+","+formatPercentage(s/l*100)}r!=Versions.VERSION3||I&&!g.includes("sizeByWh")?!I||g.includes("sizeByW")?c=o+",":g.includes("sizeByH")?c=","+u:g.includes("sizeByWh")?c=o+","+u:g.includes("sizeByPct")&&(c="pct:"+formatPercentage(100/x)):c=o+","+u}else if(a="full",p){const e=s[h][0],t=s[h][1];c=r==Versions.VERSION3?e==n&&t==l?"max":e+","+t:e==n?"full":e+","}else c=r==Versions.VERSION3?"max":"full";return i+a+"/"+c+"/0/"+f+"."+u}},transition:t.transition}),this.zDirection=t.zDirection}}export default IIIF;
//# sourceMappingURL=/sm/d9ffb01b9002a7ef87550e3827e2c7e444efdb5c525a1004e4fafbb55eb3140a.map