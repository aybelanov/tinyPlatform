/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/render/canvas/hitdetect.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import CanvasImmediateRenderer from"./Immediate.js";import{Icon}from"../../style.js";import{ascending}from"../../array.js";import{clamp}from"../../math.js";import{createCanvasContext2D}from"../../dom.js";import{intersects}from"../../extent.js";export const HIT_DETECT_RESOLUTION=.5;export function createHitDetectionImageData(t,e,o,n,r,a,i){const s=.5*t[0],c=.5*t[1],l=createCanvasContext2D(s,c);l.imageSmoothingEnabled=!1;const g=l.canvas,m=new CanvasImmediateRenderer(l,.5,r,null,i),h=o.length,f=Math.floor(16777215/h),p={};for(let t=1;t<=h;++t){const e=o[t-1],i=e.getStyleFunction()||n;if(!i)continue;let s=i(e,a);if(!s)continue;Array.isArray(s)||(s=[s]);const c=(t*f).toString(16).padStart(7,"#00000");for(let t=0,o=s.length;t<o;++t){const o=s[t],n=o.getGeometryFunction()(e);if(!n||!intersects(r,n.getExtent()))continue;const a=o.clone(),i=a.getFill();i&&i.setColor(c);const l=a.getStroke();l&&(l.setColor(c),l.setLineDash(null)),a.setText(void 0);const g=o.getImage();if(g){const t=g.getImageSize();if(!t)continue;const e=createCanvasContext2D(t[0],t[1],void 0,{alpha:!1}),o=e.canvas;e.fillStyle=c,e.fillRect(0,0,o.width,o.height),a.setImage(new Icon({img:o,anchor:g.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:g.getOrigin(),opacity:1,size:g.getSize(),scale:g.getScale(),rotation:g.getRotation(),rotateWithView:g.getRotateWithView()}))}const m=a.getZIndex()||0;let h=p[m];h||(h={},p[m]=h,h.Polygon=[],h.Circle=[],h.LineString=[],h.Point=[]);const f=n.getType();if("GeometryCollection"===f){const t=n.getGeometriesArrayRecursive();for(let e=0,o=t.length;e<o;++e){const o=t[e];h[o.getType().replace("Multi","")].push(o,a)}}else h[f.replace("Multi","")].push(n,a)}}const d=Object.keys(p).map(Number).sort(ascending);for(let t=0,o=d.length;t<o;++t){const o=p[d[t]];for(const t in o){const n=o[t];for(let t=0,o=n.length;t<o;t+=2){m.setStyle(n[t+1]);for(let o=0,r=e.length;o<r;++o)m.setTransform(e[o]),m.drawGeometry(n[t])}}}return l.getImageData(0,0,g.width,g.height)}export function hitDetect(t,e,o){const n=[];if(o){const r=Math.floor(.5*Math.round(t[0])),a=Math.floor(.5*Math.round(t[1])),i=4*(clamp(r,0,o.width-1)+clamp(a,0,o.height-1)*o.width),s=o.data[i],c=o.data[i+1],l=o.data[i+2]+256*(c+256*s),g=Math.floor(16777215/e.length);l&&l%g==0&&n.push(e[l/g-1])}return n}
//# sourceMappingURL=/sm/3404e01d2c2fb2da206943fbc652b0b360a18b69844053aaa348a12131ec095d.map