/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/control/ScaleLine.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Control from"./Control.js";import{CLASS_UNSELECTABLE}from"../css.js";import{METERS_PER_UNIT,getPointResolution}from"../proj.js";const UNITS_PROP="units",LEADING_DIGITS=[1,2,5],DEFAULT_DPI=25.4/.28;class ScaleLine extends Control{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=void 0!==e.className?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+CLASS_UNSELECTABLE,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=void 0!==e.minWidth?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener("units",this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get("units")}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set("units",e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const t=e.center,i=e.projection,s=this.getUnits(),n="degrees"==s?"degrees":"m";let r=getPointResolution(i,e.resolution,t,n);const l=this.minWidth_*(this.dpi_||DEFAULT_DPI)/DEFAULT_DPI,a=void 0!==this.maxWidth_?this.maxWidth_*(this.dpi_||DEFAULT_DPI)/DEFAULT_DPI:void 0;let o=l*r,d="";if("degrees"==s){const e=METERS_PER_UNIT.degrees;o*=e,o<e/60?(d="″",r*=3600):o<e?(d="′",r*=60):d="°"}else if("imperial"==s)o<.9144?(d="in",r/=.0254):o<1609.344?(d="ft",r/=.3048):(d="mi",r/=1609.344);else if("nautical"==s)r/=1852,d="NM";else if("metric"==s)o<.001?(d="μm",r*=1e6):o<1?(d="mm",r*=1e3):o<1e3?d="m":(d="km",r/=1e3);else{if("us"!=s)throw new Error("Invalid units");o<.9144?(d="in",r*=39.37):o<1609.344?(d="ft",r/=.30480061):(d="mi",r/=1609.3472)}let h,c,_,m,p,u,S=3*Math.floor(Math.log(l*r)/Math.log(10));for(;;){_=Math.floor(S/3);const e=Math.pow(10,_);if(h=LEADING_DIGITS[(S%3+3)%3]*e,c=Math.round(h/r),isNaN(c))return this.element.style.display="none",void(this.renderedVisible_=!1);if(void 0!==a&&c>=a){h=m,c=p,_=u;break}if(c>=l)break;m=h,p=c,u=_,++S}const v=this.scaleBar_?this.createScaleBar(c,h,d):h.toFixed(_<0?-_:0)+" "+d;this.renderedHTML_!=v&&(this.innerElement_.innerHTML=v,this.renderedHTML_=v),this.renderedWidth_!=c&&(this.innerElement_.style.width=c+"px",this.renderedWidth_=c),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const s=this.getScaleForResolution(),n=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),r=this.scaleBarSteps_,l=e/r,a=[this.createMarker("absolute")];for(let s=0;s<r;++s){const n=s%2==0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";a.push(`<div><div class="ol-scale-singlebar ${n}" style="width: ${l}px;"></div>`+this.createMarker("relative")+(s%2==0||2===r?this.createStepText(s,e,!1,t,i):"")+"</div>")}a.push(this.createStepText(r,e,!0,t,i));return(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+n+"</div>":"")+a.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${"absolute"===e?3:-10}px;"></div>`}createStepText(e,t,i,s,n){const r=(0===e?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(0===e?"":" "+n);return`<div class="ol-scale-step-text" style="margin-left: ${0===e?-3:t/this.scaleBarSteps_*-1}px;text-align: ${0===e?"left":"center"};min-width: ${0===e?0:t/this.scaleBarSteps_*2}px;left: ${i?t+"px":"unset"};">`+r+"</div>"}getScaleForResolution(){return getPointResolution(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m")*(1e3/25.4)*(this.dpi_||DEFAULT_DPI)}render(e){const t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()}}export default ScaleLine;
//# sourceMappingURL=/sm/3a324ee482332daab7e7906d85143d8bf0cb539edae23498aef515deb16f203f.map