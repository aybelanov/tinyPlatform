/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/control/OverviewMap.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Collection from"../Collection.js";import Control from"./Control.js";import EventType from"../events/EventType.js";import Map from"../Map.js";import MapEventType from"../MapEventType.js";import MapProperty from"../MapProperty.js";import ObjectEventType from"../ObjectEventType.js";import Overlay from"../Overlay.js";import View from"../View.js";import ViewProperty from"../ViewProperty.js";import{CLASS_COLLAPSED,CLASS_CONTROL,CLASS_UNSELECTABLE}from"../css.js";import{containsExtent,equals as equalsExtent,getBottomRight,getTopLeft,scaleFromCenter}from"../extent.js";import{listen,listenOnce}from"../events.js";import{fromExtent as polygonFromExtent}from"../geom/Polygon.js";import{replaceNode}from"../dom.js";const MAX_RATIO=.75,MIN_RATIO=.1;class OverviewMap extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=void 0===e.collapsed||e.collapsed,this.collapsible_=void 0===e.collapsible||e.collapsible,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=void 0!==e.rotateWithView&&e.rotateWithView,this.viewExtent_=void 0;const t=void 0!==e.className?e.className:"ol-overviewmap",i=void 0!==e.tipLabel?e.tipLabel:"Overview map",o=void 0!==e.collapseLabel?e.collapseLabel:"‹";"string"==typeof o?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;const s=void 0!==e.label?e.label:"›";"string"==typeof s?(this.label_=document.createElement("span"),this.label_.textContent=s):this.label_=s;const n=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=i,a.appendChild(n),a.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const l=new Map({view:e.view,controls:new Collection,interactions:new Collection});this.ovmap_=l,e.layers&&e.layers.forEach((function(e){l.addLayer(e)}));const r=document.createElement("div");r.className="ol-overviewmap-box",r.style.boxSizing="border-box",this.boxOverlay_=new Overlay({position:[0,0],positioning:"center-center",element:r}),this.ovmap_.addOverlay(this.boxOverlay_);const p=t+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=p,h.appendChild(this.ovmapDiv_),h.appendChild(a);const d=this,c=this.boxOverlay_,_=this.boxOverlay_.getElement(),v=function(e){const t={clientX:(i=e).clientX,clientY:i.clientY};var i;const o=l.getEventCoordinateInternal(t);c.setPosition(o)},m=function(e){const t=l.getEventCoordinateInternal(e);d.getMap().getView().setCenterInternal(t),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",m)};_.addEventListener("mousedown",(function(){window.addEventListener("mousemove",v),window.addEventListener("mouseup",m)}))}setMap(e){const t=this.getMap();if(e!==t){if(t){const e=t.getView();e&&this.unbindView_(e),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(listen(e,ObjectEventType.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const t=e.getView();t&&(this.bindView_(t),t.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===MapProperty.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const i=this.getMap().getView();this.bindView_(i)}else this.ovmap_.isRendered()||e.key!==MapProperty.TARGET&&e.key!==MapProperty.SIZE||this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new View({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(ViewProperty.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(ViewProperty.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),o=e.getView().calculateExtentInternal(i);if(this.viewExtent_&&equalsExtent(o,this.viewExtent_))return;this.viewExtent_=o;const s=t.getSize(),n=t.getView().calculateExtentInternal(s),a=t.getPixelFromCoordinateInternal(getTopLeft(o)),l=t.getPixelFromCoordinateInternal(getBottomRight(o)),r=Math.abs(a[0]-l[0]),p=Math.abs(a[1]-l[1]),h=s[0],d=s[1];r<.1*h||p<.1*d||r>.75*h||p>.75*d?this.resetExtent_():containsExtent(n,o)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,i=e.getSize(),o=e.getView().calculateExtentInternal(i),s=t.getView(),n=Math.log(7.5)/Math.LN2,a=1/(.1*Math.pow(2,n/2));scaleFromCenter(o,a),s.fitInternal(polygonFromExtent(o))}recenter_(){const e=this.getMap(),t=this.ovmap_,i=e.getView();t.getView().setCenterInternal(i.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),o=e.getView(),s=t.getView(),n=this.rotateWithView_?0:-o.getRotation(),a=this.boxOverlay_,l=this.boxOverlay_.getElement(),r=o.getCenterInternal(),p=o.getResolution(),h=s.getResolution(),d=i[0]*p/h,c=i[1]*p/h;if(a.setPosition(r),l){l.style.width=d+"px",l.style.height=c+"px";const e="rotate("+n+"rad)";l.style.transform=e}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=listenOnce(this.ovmap_,MapEventType.POSTRENDER,(function(e){delete this.ovmapPostrenderKey_,this.updateBox_()}),this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered())return this.viewExtent_=void 0,void e.render();e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,0!==this.getMap().getView().getRotation()&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}}export default OverviewMap;
//# sourceMappingURL=/sm/fe74171a6fabf7929f568d020144c18e464f3be31232d3a919513df724ce65db.map