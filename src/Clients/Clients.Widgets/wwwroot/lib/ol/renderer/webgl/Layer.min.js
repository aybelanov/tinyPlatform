/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/renderer/webgl/Layer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import LayerProperty from"../../layer/Property.js";import LayerRenderer from"../Layer.js";import RenderEvent from"../../render/Event.js";import RenderEventType from"../../render/EventType.js";import WebGLHelper from"../../webgl/Helper.js";import{compose as composeTransform,create as createTransform}from"../../transform.js";class WebGLLayerRenderer extends LayerRenderer{constructor(e,r){super(e),r=r||{},this.inversePixelTransform_=createTransform(),this.pixelContext_=null,this.postProcesses_=r.postProcesses,this.uniforms_=r.uniforms,this.helper,e.addChangeListener(LayerProperty.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,r){const t=this.getLayer();if(t.hasListener(RenderEventType.PRECOMPOSE)){const s=new RenderEvent(RenderEventType.PRECOMPOSE,void 0,r,e);t.dispatchEvent(s)}}dispatchPostComposeEvent(e,r){const t=this.getLayer();if(t.hasListener(RenderEventType.POSTCOMPOSE)){const s=new RenderEvent(RenderEventType.POSTCOMPOSE,void 0,r,e);t.dispatchEvent(s)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let r,t=!0,s=-1;for(let n=0,i=e.layerStatesArray.length;n<i;n++){const i=e.layerStatesArray[n].layer,o=i.getRenderer();if(!(o instanceof WebGLLayerRenderer)){t=!0;continue}const a=i.getClassName();if((t||a!==r)&&(s+=1,t=!1),r=a,o===this)break}const n="map/"+e.mapId+"/group/"+s;this.helper&&this.helper.canvasCacheKeyMatches(n)&&!this.helper.needsToBeRecreated()||(this.removeHelper(),this.helper=new WebGLHelper({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:n}),r&&(this.helper.getCanvas().className=r),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,r,t){const s=this.getLayer();if(s.hasListener(e)){composeTransform(this.inversePixelTransform_,0,0,t.pixelRatio,-t.pixelRatio,0,0,-t.size[1]);const n=new RenderEvent(e,this.inversePixelTransform_,t,r);s.dispatchEvent(n)}}preRender(e,r){this.dispatchRenderEvent_(RenderEventType.PRERENDER,e,r)}postRender(e,r){this.dispatchRenderEvent_(RenderEventType.POSTRENDER,e,r)}}export default WebGLLayerRenderer;
//# sourceMappingURL=/sm/92c6cd85dd4cc807141514dfdd2d27c0ce521a3e19b7550971f9643bab45cec3.map