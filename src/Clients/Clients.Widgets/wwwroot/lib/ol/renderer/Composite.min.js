/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/renderer/Composite.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import MapRenderer from"./Map.js";import ObjectEventType from"../ObjectEventType.js";import RenderEvent from"../render/Event.js";import RenderEventType from"../render/EventType.js";import{CLASS_UNSELECTABLE}from"../css.js";import{checkedFonts}from"../render/canvas.js";import{inView}from"../layer/Layer.js";import{listen,unlistenByKey}from"../events.js";import{replaceChildren}from"../dom.js";class CompositeMapRenderer extends MapRenderer{constructor(e){super(e),this.fontChangeListenerKey_=listen(checkedFonts,ObjectEventType.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=CLASS_UNSELECTABLE+" ol-layers";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const r=new RenderEvent(e,void 0,t);n.dispatchEvent(r)}}disposeInternal(){unlistenByKey(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(e),this.dispatchRenderEvent(RenderEventType.PRECOMPOSE,e);const t=e.layerStatesArray.sort((function(e,t){return e.zIndex-t.zIndex})),n=e.viewState;this.children_.length=0;const r=this.declutterLayers_;r.length=0;let s=null;for(let i=0,l=t.length;i<l;++i){const l=t[i];e.layerIndex=i;const d=l.layer,o=d.getSourceState();if(!inView(l,n)||"ready"!=o&&"undefined"!=o){d.unrender();continue}const h=d.render(e,s);h&&(h!==s&&(this.children_.push(h),s=h),"getDeclutter"in d&&r.push(d))}this.flushDeclutterItems(e),replaceChildren(this.element_,this.children_),this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let n=t.length-1;n>=0;--n)t[n].renderDeclutter(e);t.length=0}}export default CompositeMapRenderer;
//# sourceMappingURL=/sm/7c5c945a79cdee27cb1f028d6bc0ee4d50969ecfc892ae74369b3b979dffb844.map