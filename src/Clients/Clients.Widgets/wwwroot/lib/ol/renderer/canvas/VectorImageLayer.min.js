/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/renderer/canvas/VectorImageLayer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import CanvasImageLayerRenderer from"./ImageLayer.js";import CanvasVectorLayerRenderer from"./VectorLayer.js";import EventType from"../../events/EventType.js";import ImageCanvas from"../../ImageCanvas.js";import ImageState from"../../ImageState.js";import RBush from"rbush";import ViewHint from"../../ViewHint.js";import{apply,compose,create}from"../../transform.js";import{fromResolutionLike}from"../../resolution.js";import{getHeight,getWidth,isEmpty,scaleFromCenter}from"../../extent.js";class CanvasVectorImageLayerRenderer extends CanvasImageLayerRenderer{constructor(e){super(e),this.vectorRenderer_=new CanvasVectorLayerRenderer(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=create(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const r=apply(this.coordinateToVectorPixelTransform_,apply(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(r)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const r=e.pixelRatio,t=e.viewState,o=t.resolution,a=e.viewHints,n=this.vectorRenderer_;let i=e.extent;1!==this.layerImageRatio_&&(i=i.slice(0),scaleFromCenter(i,this.layerImageRatio_));const s=getWidth(i)/o,m=getHeight(i)/o;if(!a[ViewHint.ANIMATING]&&!a[ViewHint.INTERACTING]&&!isEmpty(i)){n.useContainer(null,null);const a=n.context,d=e.layerStatesArray[e.layerIndex],l=Object.assign({},d,{opacity:1}),c=Object.assign({},e,{declutterTree:new RBush(9),extent:i,size:[s,m],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[l],layerIndex:0});let p=!0;const g=new ImageCanvas(i,o,r,a.canvas,(function(e){n.prepareFrame(c)&&n.replayGroupChanged&&(n.clipping=!1,n.renderFrame(c,null)&&(n.renderDeclutter(c),p=!1),e())}));g.addEventListener(EventType.CHANGE,(()=>{if(g.getState()!==ImageState.LOADED)return;this.image_=p?null:g;const e=g.getPixelRatio(),o=fromResolutionLike(g.getResolution())*r/e;this.renderedResolution=o,this.coordinateToVectorPixelTransform_=compose(this.coordinateToVectorPixelTransform_,s/2,m/2,1/o,-1/o,0,-t.center[0],-t.center[1])})),g.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,r,t,o,a){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,r,t,o,a):super.forEachFeatureAtCoordinate(e,r,t,o,a)}}export default CanvasVectorImageLayerRenderer;
//# sourceMappingURL=/sm/13c94116ac917dcba11c5dfcd40fc44e38e174f082b575877f91a5b1c57b64a8.map