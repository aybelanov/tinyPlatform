/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/Map.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import BaseObject from"./Object.js";import Collection from"./Collection.js";import CollectionEventType from"./CollectionEventType.js";import CompositeMapRenderer from"./renderer/Composite.js";import EventType from"./events/EventType.js";import Layer from"./layer/Layer.js";import LayerGroup,{GroupEvent}from"./layer/Group.js";import MapBrowserEvent from"./MapBrowserEvent.js";import MapBrowserEventHandler from"./MapBrowserEventHandler.js";import MapBrowserEventType from"./MapBrowserEventType.js";import MapEvent from"./MapEvent.js";import MapEventType from"./MapEventType.js";import MapProperty from"./MapProperty.js";import ObjectEventType from"./ObjectEventType.js";import PointerEventType from"./pointer/EventType.js";import RenderEventType from"./render/EventType.js";import TileQueue,{getTilePriority}from"./TileQueue.js";import View from"./View.js";import ViewHint from"./ViewHint.js";import{DEVICE_PIXEL_RATIO,PASSIVE_EVENT_LISTENERS}from"./has.js";import{TRUE}from"./functions.js";import{apply as applyTransform,create as createTransform}from"./transform.js";import{assert}from"./asserts.js";import{clone,createOrUpdateEmpty,equals as equalsExtent,getForViewAndSize,isEmpty}from"./extent.js";import{defaults as defaultControls}from"./control/defaults.js";import{defaults as defaultInteractions}from"./interaction/defaults.js";import{equals}from"./array.js";import{fromUserCoordinate,toUserCoordinate}from"./proj.js";import{getUid}from"./util.js";import{hasArea}from"./size.js";import{listen,unlistenByKey}from"./events.js";import{removeNode}from"./dom.js";import{warn}from"./console.js";function removeLayerMapProperty(e){e instanceof Layer?e.setMapInternal(null):e instanceof LayerGroup&&e.getLayers().forEach(removeLayerMapProperty)}function setLayerMapProperty(e,t){if(e instanceof Layer)e.setMapInternal(t);else if(e instanceof LayerGroup){const r=e.getLayers().getArray();for(let e=0,i=r.length;e<i;++e)setLayerMapProperty(r[e],t)}}class Map extends BaseObject{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=createOptionsInternal(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==e.maxTilesLoading?e.maxTilesLoading:16,this.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:DEVICE_PIXEL_RATIO,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=createTransform(),this.pixelToCoordinateTransform_=createTransform(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver((()=>this.updateSize())),this.controls=t.controls||defaultControls(),this.interactions=t.interactions||defaultInteractions({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(MapProperty.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(MapProperty.VIEW,this.handleViewChanged_),this.addChangeListener(MapProperty.SIZE,this.handleSizeChanged_),this.addChangeListener(MapProperty.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const r=this;!e.view||e.view instanceof View||e.view.then((function(e){r.setView(new View(e))})),this.controls.addEventListener(CollectionEventType.ADD,(e=>{e.element.setMap(this)})),this.controls.addEventListener(CollectionEventType.REMOVE,(e=>{e.element.setMap(null)})),this.interactions.addEventListener(CollectionEventType.ADD,(e=>{e.element.setMap(this)})),this.interactions.addEventListener(CollectionEventType.REMOVE,(e=>{e.element.setMap(null)})),this.overlays_.addEventListener(CollectionEventType.ADD,(e=>{this.addOverlayInternal_(e.element)})),this.overlays_.addEventListener(CollectionEventType.REMOVE,(e=>{const t=e.element.getId();void 0!==t&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)})),this.controls.forEach((e=>{e.setMap(this)})),this.interactions.forEach((e=>{e.setMap(this)})),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){setLayerMapProperty(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();void 0!==t&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,r){if(!this.frameState_||!this.renderer_)return;const i=this.getCoordinateFromPixelInternal(e),n=void 0!==(r=void 0!==r?r:{}).hitTolerance?r.hitTolerance:0,s=void 0!==r.layerFilter?r.layerFilter:TRUE,o=!1!==r.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,n,o,t,null,s,null)}getFeaturesAtPixel(e,t){const r=[];return this.forEachFeatureAtPixel(e,(function(e){r.push(e)}),t),r}getAllLayers(){const e=[];return function t(r){r.forEach((function(r){r instanceof LayerGroup?t(r.getLayers()):e.push(r)}))}(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const r=this.getCoordinateFromPixelInternal(e),i=void 0!==(t=void 0!==t?t:{}).layerFilter?t.layerFilter:TRUE,n=void 0!==t.hitTolerance?t.hitTolerance:0,s=!1!==t.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,n,s,i,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const t=this.viewport_.getBoundingClientRect(),r=this.getSize(),i=t.width/r[0],n=t.height/r[1],s="changedTouches"in e?e.changedTouches[0]:e;return[(s.clientX-t.left)/i,(s.clientY-t.top)/n]}getTarget(){return this.get(MapProperty.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return toUserCoordinate(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?applyTransform(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return void 0!==t?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(MapProperty.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof Collection)return void t.setLayers(e);const r=t.getLayers();r.clear(),r.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,r=e.length;t<r;++t){const r=e[t];if(!r.visible)continue;const i=r.layer.getRenderer();if(i&&!i.ready)return!0;const n=r.layer.getSource();if(n&&n.loading)return!0}return!1}getPixelFromCoordinate(e){const t=fromUserCoordinate(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?applyTransform(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(MapProperty.SIZE)}getView(){return this.get(MapProperty.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,r,i){return getTilePriority(this.frameState_,e,t,r,i)}handleBrowserEvent(e,t){t=t||e.type;const r=new MapBrowserEvent(t,this,e);this.handleMapBrowserEvent(r)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,r=t.type;if(r===PointerEventType.POINTERDOWN||r===EventType.WHEEL||r===EventType.KEYDOWN){const e=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():e,i=t.target;if(this.overlayContainerStopEvent_.contains(i)||!(r===e?e.documentElement:r).contains(i))return}if(e.frameState=this.frameState_,!1!==this.dispatchEvent(e)){const t=this.getInteractions().getArray().slice();for(let r=t.length-1;r>=0;r--){const i=t[r];if(i.getMap()!==this||!i.getActive()||!this.getTargetElement())continue;if(!i.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let r=this.maxTilesLoading_,i=r;if(e){const t=e.viewHints;if(t[ViewHint.ANIMATING]||t[ViewHint.INTERACTING]){const t=Date.now()-e.time>8;r=t?0:8,i=t?0:2}}t.getTilesLoading()<r&&(t.reprioritize(),t.loadMoreTiles(r,i))}e&&this.renderer_&&!e.animate&&(!0===this.renderComplete_?(this.hasListener(RenderEventType.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(RenderEventType.RENDERCOMPLETE,e),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new MapEvent(MapEventType.LOADEND,this,e)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new MapEvent(MapEventType.LOADSTART,this,e))));const r=this.postRenderFunctions_;for(let t=0,i=r.length;t<i;++t)r[t](this,e);r.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,t=this.targetChangeHandlerKeys_.length;e<t;++e)unlistenByKey(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,removeNode(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const e=this.targetElement_.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.unobserve(e.host),this.setSize(void 0)}const e=this.getTarget(),t="string"==typeof e?document.getElementById(e):e;if(this.targetElement_=t,t){t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new CompositeMapRenderer(this)),this.mapBrowserEventHandler_=new MapBrowserEventHandler(this,this.moveTolerance_);for(const e in MapBrowserEventType)this.mapBrowserEventHandler_.addEventListener(MapBrowserEventType[e],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_,!!PASSIVE_EVENT_LISTENERS&&{passive:!1});const e=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[listen(e,EventType.KEYDOWN,this.handleBrowserEvent,this),listen(e,EventType.KEYPRESS,this.handleBrowserEvent,this)];const r=t.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(t)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=listen(e,ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=listen(e,EventType.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new GroupEvent("addlayer",e)),this.layerGroupPropertyListenerKeys_=[listen(e,ObjectEventType.PROPERTYCHANGE,this.render,this),listen(e,EventType.CHANGE,this.render,this),listen(e,"addlayer",this.handleLayerAdd_,this),listen(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,r=e.length;t<r;++t){const r=e[t].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const e=this.frameState_;e&&this.renderer_.flushDeclutterItems(e)}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){removeLayerMapProperty(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),r=this.getView(),i=this.frameState_;let n=null;if(void 0!==t&&hasArea(t)&&r&&r.isDef()){const i=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),s=r.getState();if(n={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:getForViewAndSize(s.center,s.resolution,s.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:s,viewHints:i,wantedTiles:{},mapId:getUid(this),renderTargets:{}},s.nextCenter&&s.nextResolution){const e=isNaN(s.nextRotation)?s.rotation:s.nextRotation;n.nextExtent=getForViewAndSize(s.nextCenter,s.nextResolution,e,t)}}if(this.frameState_=n,this.renderer_.renderFrame(n),n){if(n.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,n.postRenderFunctions),i){(!this.previousExtent_||!isEmpty(this.previousExtent_)&&!equalsExtent(n.extent,this.previousExtent_))&&(this.dispatchEvent(new MapEvent(MapEventType.MOVESTART,this,i)),this.previousExtent_=createOrUpdateEmpty(this.previousExtent_))}this.previousExtent_&&!n.viewHints[ViewHint.ANIMATING]&&!n.viewHints[ViewHint.INTERACTING]&&!equalsExtent(n.extent,this.previousExtent_)&&(this.dispatchEvent(new MapEvent(MapEventType.MOVEEND,this,n)),clone(n.extent,this.previousExtent_))}this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER,this,n)),this.renderComplete_=this.hasListener(MapEventType.LOADSTART)||this.hasListener(MapEventType.LOADEND)||this.hasListener(RenderEventType.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout((()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()}),0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new GroupEvent("removelayer",t)),this.set(MapProperty.LAYERGROUP,e)}setSize(e){this.set(MapProperty.SIZE,e)}setTarget(e){this.set(MapProperty.TARGET,e)}setView(e){if(!e||e instanceof View)return void this.set(MapProperty.VIEW,e);this.set(MapProperty.VIEW,new View);const t=this;e.then((function(e){t.setView(new View(e))}))}updateSize(){const e=this.getTargetElement();let t;if(e){const r=getComputedStyle(e),i=e.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),n=e.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);isNaN(i)||isNaN(n)||(t=[i,n],!hasArea(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&warn("No map visible because the map container's width or height are 0."))}const r=this.getSize();!t||r&&equals(t,r)||(this.setSize(t),this.updateViewportSize_())}updateViewportSize_(){const e=this.getView();if(e){let t;const r=getComputedStyle(this.viewport_);r.width&&r.height&&(t=[parseInt(r.width,10),parseInt(r.height,10)]),e.setViewportSize(t)}}}function createOptionsInternal(e){let t=null;void 0!==e.keyboardEventTarget&&(t="string"==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);const r={},i=e.layers&&"function"==typeof e.layers.getLayers?e.layers:new LayerGroup({layers:e.layers});let n,s,o;return r[MapProperty.LAYERGROUP]=i,r[MapProperty.TARGET]=e.target,r[MapProperty.VIEW]=e.view instanceof View?e.view:new View,void 0!==e.controls&&(Array.isArray(e.controls)?n=new Collection(e.controls.slice()):(assert("function"==typeof e.controls.getArray,"Expected `controls` to be an array or an `ol/Collection.js`"),n=e.controls)),void 0!==e.interactions&&(Array.isArray(e.interactions)?s=new Collection(e.interactions.slice()):(assert("function"==typeof e.interactions.getArray,"Expected `interactions` to be an array or an `ol/Collection.js`"),s=e.interactions)),void 0!==e.overlays?Array.isArray(e.overlays)?o=new Collection(e.overlays.slice()):(assert("function"==typeof e.overlays.getArray,"Expected `overlays` to be an array or an `ol/Collection.js`"),o=e.overlays):o=new Collection,{controls:n,interactions:s,keyboardEventTarget:t,overlays:o,values:r}}export default Map;
//# sourceMappingURL=/sm/f3c1efd599f292da2feef1e5faa54960d82b0f7af149d1bb1e5a73335480a84c.map