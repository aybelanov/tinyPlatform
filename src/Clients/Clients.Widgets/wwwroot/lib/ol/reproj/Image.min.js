/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/reproj/Image.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{ERROR_THRESHOLD}from"./common.js";import EventType from"../events/EventType.js";import ImageState from"../ImageState.js";import ImageWrapper from"../Image.js";import Triangulation from"./Triangulation.js";import{calculateSourceResolution,render as renderReprojected}from"../reproj.js";import{fromResolutionLike}from"../resolution.js";import{getCenter,getHeight,getIntersection,getWidth,isEmpty}from"../extent.js";import{listen,unlistenByKey}from"../events.js";class ReprojImage extends ImageWrapper{constructor(t,e,s,i,r,o,a){let n=t.getExtent();n&&t.canWrapX()&&(n=n.slice(),n[0]=-1/0,n[2]=1/0);let g=e.getExtent();g&&e.canWrapX()&&(g=g.slice(),g[0]=-1/0,g[2]=1/0);const u=g?getIntersection(s,g):s,c=getCenter(u),m=calculateSourceResolution(t,e,c,i),h=new Triangulation(t,e,u,n,m*ERROR_THRESHOLD,i),l=h.calculateSourceExtent(),_=isEmpty(l)?null:o(l,m,r),I=_?ImageState.IDLE:ImageState.EMPTY,p=_?_.getPixelRatio():1;super(s,i,p,I),this.targetProj_=e,this.maxSourceExtent_=n,this.triangulation_=h,this.targetResolution_=i,this.targetExtent_=s,this.sourceImage_=_,this.sourcePixelRatio_=p,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==ImageState.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==ImageState.LOADED){const t=getWidth(this.targetExtent_)/this.targetResolution_,e=getHeight(this.targetExtent_)/this.targetResolution_;this.canvas_=renderReprojected(t,e,this.sourcePixelRatio_,fromResolutionLike(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=t,this.changed()}load(){if(this.state==ImageState.IDLE){this.state=ImageState.LOADING,this.changed();const t=this.sourceImage_.getState();t==ImageState.LOADED||t==ImageState.ERROR?this.reproject_():(this.sourceListenerKey_=listen(this.sourceImage_,EventType.CHANGE,(function(t){const e=this.sourceImage_.getState();e!=ImageState.LOADED&&e!=ImageState.ERROR||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}}unlistenSource_(){unlistenByKey(this.sourceListenerKey_),this.sourceListenerKey_=null}}export default ReprojImage;
//# sourceMappingURL=/sm/7fde64e161b97fd6bc50bf90d829cae369302674effb1770a2d7ea2cfdd3e6bf.map