/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/style/Icon.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import EventType from"../events/EventType.js";import ImageState from"../ImageState.js";import ImageStyle from"./Image.js";import{asArray}from"../color.js";import{assert}from"../asserts.js";import{get as getIconImage}from"./IconImage.js";import{getUid}from"../util.js";function calculateScale(t,i,e,o){return void 0!==e&&void 0!==o?[e/t,o/i]:void 0!==e?e/t:void 0!==o?o/i:1}class Icon extends ImageStyle{constructor(t){const i=void 0!==(t=t||{}).opacity?t.opacity:1,e=void 0!==t.rotation?t.rotation:0,o=void 0!==t.scale?t.scale:1,s=void 0!==t.rotateWithView&&t.rotateWithView;super({opacity:i,rotation:e,scale:o,displacement:void 0!==t.displacement?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=void 0!==t.anchor?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==t.anchorOrigin?t.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==t.anchorXUnits?t.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==t.anchorYUnits?t.anchorYUnits:"fraction",this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;const n=void 0!==t.img?t.img:null;let r,a=t.src;if(assert(!(void 0!==a&&n),"`image` and `src` cannot be provided at the same time"),void 0!==a&&0!==a.length||!n||(a=n.src||getUid(n)),assert(void 0!==a&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),assert(!((void 0!==t.width||void 0!==t.height)&&void 0!==t.scale),"`width` or `height` cannot be provided together with `scale`"),void 0!==t.src?r=ImageState.IDLE:void 0!==n&&(r=n instanceof HTMLImageElement?n.complete?n.src?ImageState.LOADED:ImageState.IDLE:ImageState.LOADING:ImageState.LOADED),this.color_=void 0!==t.color?asArray(t.color):null,this.iconImage_=getIconImage(n,a,this.crossOrigin_,r,this.color_),this.offset_=void 0!==t.offset?t.offset:[0,0],this.offsetOrigin_=void 0!==t.offsetOrigin?t.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==t.size?t.size:null,void 0!==t.width||void 0!==t.height){let i,e;if(t.size)[i,e]=t.size;else{const o=this.getImage(1);if(o.width&&o.height)i=o.width,e=o.height;else if(o instanceof HTMLImageElement){this.initialOptions_=t;const i=()=>{if(this.unlistenImageChange(i),!this.initialOptions_)return;const e=this.iconImage_.getSize();this.setScale(calculateScale(e[0],e[1],t.width,t.height))};return void this.listenImageChange(i)}}void 0!==i&&this.setScale(calculateScale(i,e,t.width,t.height))}}clone(){let t,i,e;return this.initialOptions_?(i=this.initialOptions_.width,e=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:i,height:e,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const i=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!i)return null;t=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(t[0]*=i[0]),"fraction"==this.anchorYUnits_&&(t[1]*=i[1])}if("top-left"!=this.anchorOrigin_){if(!i)return null;t===this.anchor_&&(t=this.anchor_.slice()),"top-right"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[0]=-t[0]+i[0]),"bottom-left"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[1]=-t[1]+i[1])}this.normalizedAnchor_=t}const i=this.getDisplacement(),e=this.getScaleArray();return[t[0]-i[0]/e[0],t[1]+i[1]/e[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if("top-left"!=this.offsetOrigin_){const i=this.getSize(),e=this.iconImage_.getSize();if(!i||!e)return null;t=t.slice(),"top-right"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[0]=e[0]-i[0]-t[0]),"bottom-left"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[1]=e[1]-i[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();return this.size_?this.size_[0]*t[0]:this.iconImage_.getImageState()==ImageState.LOADED?this.iconImage_.getSize()[0]*t[0]:void 0}getHeight(){const t=this.getScaleArray();return this.size_?this.size_[1]*t[1]:this.iconImage_.getImageState()==ImageState.LOADED?this.iconImage_.getSize()[1]*t[1]:void 0}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(EventType.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(EventType.CHANGE,t)}}export default Icon;
//# sourceMappingURL=/sm/0a5351f6ada58030b782f8e83dd831823663575f85a7018f3bf14246bd4a00ea.map