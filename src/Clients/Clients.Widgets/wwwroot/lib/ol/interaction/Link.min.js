/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/interaction/Link.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import EventType from"../events/EventType.js";import Interaction from"./Interaction.js";import MapEventType from"../MapEventType.js";import{listen,unlistenByKey}from"../events.js";import{toFixed}from"../math.js";function to5(t){return toFixed(t,5)}function readNumber(t){return parseFloat(t)}function writeNumber(t){return to5(t).toString()}function differentNumber(t,e){return!isNaN(t)&&t!==readNumber(writeNumber(e))}function differentArray(t,e){return differentNumber(t[0],e[0])||differentNumber(t[1],e[1])}class Link extends Interaction{constructor(t){let e;super(),e=!0===(t=Object.assign({animate:!0,params:["x","y","z","r","l"],replace:!1,prefix:""},t||{})).animate?{duration:250}:t.animate?t.animate:null,this.animationOptions_=e,this.params_=t.params.reduce(((t,e)=>(t[e]=!0,t)),{}),this.replace_=t.replace,this.prefix_=t.prefix,this.listenerKeys_=[],this.initial_=!0,this.updateState_=this.updateState_.bind(this)}getParamName_(t){return this.prefix_?this.prefix_+t:t}get_(t,e){return t.get(this.getParamName_(e))}set_(t,e,i){e in this.params_&&t.set(this.getParamName_(e),i)}delete_(t,e){e in this.params_&&t.delete(this.getParamName_(e))}setMap(t){const e=this.getMap();super.setMap(t),t!==e&&(e&&this.unregisterListeners_(e),t&&(this.initial_=!0,this.updateState_(),this.registerListeners_(t)))}registerListeners_(t){this.listenerKeys_.push(listen(t,MapEventType.MOVEEND,this.updateUrl_,this),listen(t.getLayerGroup(),EventType.CHANGE,this.updateUrl_,this),listen(t,"change:layergroup",this.handleChangeLayerGroup_,this)),this.replace_||addEventListener("popstate",this.updateState_)}unregisterListeners_(t){for(let t=0,e=this.listenerKeys_.length;t<e;++t)unlistenByKey(this.listenerKeys_[t]);this.listenerKeys_.length=0,this.replace_||removeEventListener("popstate",this.updateState_);const e=new URL(window.location.href),i=e.searchParams;this.delete_(i,"x"),this.delete_(i,"y"),this.delete_(i,"z"),this.delete_(i,"r"),this.delete_(i,"l"),window.history.replaceState(null,"",e)}handleChangeLayerGroup_(){const t=this.getMap();t&&(this.unregisterListeners_(t),this.registerListeners_(t),this.initial_=!0,this.updateUrl_())}updateState_(){const t=this.getMap();if(!t)return;const e=t.getView();if(!e)return;const i=new URL(window.location.href).searchParams;let s=!1;const r={},n=readNumber(this.get_(i,"z"));"z"in this.params_&&differentNumber(n,e.getZoom())&&(s=!0,r.zoom=n);const a=readNumber(this.get_(i,"r"));"r"in this.params_&&differentNumber(a,e.getRotation())&&(s=!0,r.rotation=a);const o=[readNumber(this.get_(i,"x")),readNumber(this.get_(i,"y"))];("x"in this.params_||"y"in this.params_)&&differentArray(o,e.getCenter())&&(s=!0,r.center=o),s&&(!this.initial_&&this.animationOptions_?e.animate(Object.assign(r,this.animationOptions_)):(r.center&&e.setCenter(r.center),"zoom"in r&&e.setZoom(r.zoom),"rotation"in r&&e.setRotation(r.rotation)));const h=t.getAllLayers(),l=this.get_(i,"l");if("l"in this.params_&&l&&l.length===h.length)for(let t=0,e=h.length;t<e;++t){const e=parseInt(l[t]);if(!isNaN(e)){const i=Boolean(e),s=h[t];s.getVisible()!==i&&s.setVisible(i)}}}updateUrl_(){const t=this.getMap();if(!t)return;const e=t.getView();if(!e)return;const i=this.initial_;this.initial_=!1;const s=e.getCenter(),r=e.getZoom(),n=e.getRotation(),a=t.getAllLayers(),o=new Array(a.length);for(let t=0,e=a.length;t<e;++t)o[t]=a[t].getVisible()?"1":"0";const h=new URL(window.location.href),l=h.searchParams;this.set_(l,"x",writeNumber(s[0])),this.set_(l,"y",writeNumber(s[1])),this.set_(l,"z",writeNumber(r)),this.set_(l,"r",writeNumber(n)),this.set_(l,"l",o.join("")),h.href!==window.location.href&&(i||this.replace_?window.history.replaceState(history.state,"",h):window.history.pushState(null,"",h))}}export default Link;
//# sourceMappingURL=/sm/6dfa2594ac6c6a7b992773e9baf4648943fc169ff88199a5de0c6b3654ba20a7.map