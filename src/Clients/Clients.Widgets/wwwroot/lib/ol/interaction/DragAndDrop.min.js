/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/interaction/DragAndDrop.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Event from"../events/Event.js";import EventType from"../events/EventType.js";import Interaction from"./Interaction.js";import{TRUE}from"../functions.js";import{get as getProjection,getUserProjection}from"../proj.js";import{listen,unlistenByKey}from"../events.js";const DragAndDropEventType={ADD_FEATURES:"addfeatures"};export class DragAndDropEvent extends Event{constructor(t,e,s,r){super(t),this.features=s,this.file=e,this.projection=r}}class DragAndDrop extends Interaction{constructor(t){t=t||{},super({handleEvent:TRUE}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const e=t.formatConstructors?t.formatConstructors:[];for(let t=0,s=e.length;t<s;++t){let s=e[t];"function"==typeof s&&(s=new s),this.formats_.push(s),this.readAsBuffer_=this.readAsBuffer_||"arraybuffer"===s.getType()}this.projection_=t.projection?getProjection(t.projection):null,this.dropListenKeys_=null,this.source_=t.source||null,this.target=t.target?t.target:null}handleResult_(t,e){const s=e.target.result,r=this.getMap();let n,i=this.projection_;if(!i&&(i=getUserProjection(),!i)){i=r.getView().getProjection()}const o=this.formats_;for(let e=0,r=o.length;e<r;++e){const r=o[e];let a=s;this.readAsBuffer_&&"arraybuffer"!==r.getType()&&(void 0===n&&(n=(new TextDecoder).decode(s)),a=n);const h=this.tryReadFeatures_(r,a,{featureProjection:i});if(h&&h.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(h)),this.dispatchEvent(new DragAndDropEvent(DragAndDropEventType.ADD_FEATURES,t,h,i));break}}}registerListeners_(){const t=this.getMap();if(t){const e=this.target?this.target:t.getViewport();this.dropListenKeys_=[listen(e,EventType.DROP,this.handleDrop,this),listen(e,EventType.DRAGENTER,this.handleStop,this),listen(e,EventType.DRAGOVER,this.handleStop,this),listen(e,EventType.DROP,this.handleStop,this)]}}setActive(t){!this.getActive()&&t&&this.registerListeners_(),this.getActive()&&!t&&this.unregisterListeners_(),super.setActive(t)}setMap(t){this.unregisterListeners_(),super.setMap(t),this.getActive()&&this.registerListeners_()}tryReadFeatures_(t,e,s){try{return t.readFeatures(e,s)}catch(t){return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(unlistenByKey),this.dropListenKeys_=null)}handleDrop(t){const e=t.dataTransfer.files;for(let t=0,s=e.length;t<s;++t){const s=e.item(t),r=new FileReader;r.addEventListener(EventType.LOAD,this.handleResult_.bind(this,s)),this.readAsBuffer_?r.readAsArrayBuffer(s):r.readAsText(s)}}handleStop(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}}export default DragAndDrop;
//# sourceMappingURL=/sm/13f33565d37592b77eb0adc93a9c77db30b126d60fd5e2577d7d57c3fe9cbd3a.map