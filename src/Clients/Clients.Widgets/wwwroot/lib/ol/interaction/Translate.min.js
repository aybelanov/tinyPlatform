/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/interaction/Translate.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Collection from"../Collection.js";import Event from"../events/Event.js";import Feature from"../Feature.js";import InteractionProperty from"./Property.js";import PointerInteraction from"./Pointer.js";import{TRUE}from"../functions.js";import{always}from"../events/condition.js";import{fromUserCoordinate,getUserProjection}from"../proj.js";const TranslateEventType={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};export class TranslateEvent extends Event{constructor(t,e,r,s,a){super(t),this.features=e,this.coordinate=r,this.startCoordinate=s,this.mapBrowserEvent=a}}class Translate extends PointerInteraction{constructor(t){let e;if(super(t=t||{}),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=void 0!==t.features?t.features:null,t.layers&&!this.features_)if("function"==typeof t.layers)e=t.layers;else{const r=t.layers;e=function(t){return r.includes(t)}}else e=TRUE;this.layerFilter_=e,this.filter_=t.filter&&!this.features_?t.filter:TRUE,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.condition_=t.condition?t.condition:always,this.lastFeature_=null,this.addChangeListener(InteractionProperty.ACTIVE,this.handleActiveChanged_)}handleDownEvent(t){if(!t.originalEvent||!this.condition_(t))return!1;if(this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=t.coordinate,this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t);const e=this.features_||new Collection([this.lastFeature_]);return this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATESTART,e,t.coordinate,this.startCoordinate_,t)),!0}return!1}handleUpEvent(t){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(t);const e=this.features_||new Collection([this.lastFeature_]);return this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATEEND,e,t.coordinate,this.startCoordinate_,t)),this.startCoordinate_=null,!0}return!1}handleDragEvent(t){if(this.lastCoordinate_){const e=t.coordinate,r=t.map.getView().getProjection(),s=fromUserCoordinate(e,r),a=fromUserCoordinate(this.lastCoordinate_,r),i=s[0]-a[0],n=s[1]-a[1],o=this.features_||new Collection([this.lastFeature_]),l=getUserProjection();o.forEach((function(t){const e=t.getGeometry();l?(e.transform(l,r),e.translate(i,n),e.transform(r,l)):e.translate(i,n),t.setGeometry(e)})),this.lastCoordinate_=e,this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATING,o,e,this.startCoordinate_,t))}}handleMoveEvent(t){const e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(t,e){return e.forEachFeatureAtPixel(t,((t,e)=>{if(t instanceof Feature&&this.filter_(t,e)&&(!this.features_||this.features_.getArray().includes(t)))return t}),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(t){this.hitTolerance_=t}setMap(t){const e=this.getMap();super.setMap(t),this.updateState_(e)}handleActiveChanged_(){this.updateState_(null)}updateState_(t){let e=this.getMap();const r=this.getActive();if((!e||!r)&&(e=e||t,e)){e.getViewport().classList.remove("ol-grab","ol-grabbing")}}}export default Translate;
//# sourceMappingURL=/sm/7b23dfd379b18a17430b9047fc450613ccc2d37056cb098bbb324a04be9b921f.map