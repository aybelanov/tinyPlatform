/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/Image.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import EventTarget from"./events/Target.js";import EventType from"./events/EventType.js";import ImageState from"./ImageState.js";import{CREATE_IMAGE_BITMAP,IMAGE_DECODE}from"./has.js";import{listenOnce,unlistenByKey}from"./events.js";import{toPromise}from"./functions.js";class ImageWrapper extends EventTarget{constructor(e,t,n,i){super(),this.extent=e,this.pixelRatio_=n,this.resolution=t,this.state="function"==typeof i?ImageState.IDLE:i,this.image_=null,this.loader="function"==typeof i?i:null}changed(){this.dispatchEvent(EventType.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==ImageState.IDLE&&this.loader){this.state=ImageState.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;toPromise((()=>this.loader(this.getExtent(),t,this.getPixelRatio()))).then((e=>{"image"in e&&(this.image_=e.image),"extent"in e&&(this.extent=e.extent),"resolution"in e&&(this.resolution=e.resolution),"pixelRatio"in e&&(this.pixelRatio_=e.pixelRatio),(e instanceof HTMLImageElement||e instanceof ImageBitmap||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement)&&(this.image_=e),this.state=ImageState.LOADED})).catch((e=>{this.state=ImageState.ERROR,console.error(e)})).finally((()=>this.changed()))}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}export function listenImage(e,t,n){const i=e;let o=!0,s=!1,r=!1;const a=[listenOnce(i,EventType.LOAD,(function(){r=!0,s||t()}))];return i.src&&IMAGE_DECODE?(s=!0,i.decode().then((function(){o&&t()})).catch((function(e){o&&(r?t():n())}))):a.push(listenOnce(i,EventType.ERROR,n)),function(){o=!1,a.forEach(unlistenByKey)}}export function load(e,t){return new Promise(((n,i)=>{function o(){r(),n(e)}function s(){r(),i(new Error("Image load error"))}function r(){e.removeEventListener("load",o),e.removeEventListener("error",s)}e.addEventListener("load",o),e.addEventListener("error",s),t&&(e.src=t)}))}export function decodeFallback(e,t){return t&&(e.src=t),IMAGE_DECODE?new Promise(((t,n)=>e.decode().then((()=>t(e)),n))):load(e)}export function decode(e,t){return t&&(e.src=t),IMAGE_DECODE&&CREATE_IMAGE_BITMAP?e.decode().then((()=>createImageBitmap(e))):decodeFallback(e)}export default ImageWrapper;
//# sourceMappingURL=/sm/dc6b48040d03056c22c10da11802866bfc29c067b9b35dbb908f91945bf8c91f.map