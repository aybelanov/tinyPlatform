/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/format/OSMXML.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Feature from"../Feature.js";import LineString from"../geom/LineString.js";import Point from"../geom/Point.js";import Polygon from"../geom/Polygon.js";import XMLFeature from"./XMLFeature.js";import{extend}from"../array.js";import{get as getProjection}from"../proj.js";import{isEmpty}from"../obj.js";import{makeStructureNS,pushParseAndPop}from"../xml.js";import{transformGeometryWithOptions}from"./Feature.js";const NAMESPACE_URIS=[null],WAY_PARSERS=makeStructureNS(NAMESPACE_URIS,{nd:readNd,tag:readTag}),PARSERS=makeStructureNS(NAMESPACE_URIS,{node:readNode,way:readWay});class OSMXML extends XMLFeature{constructor(){super(),this.dataProjection=getProjection("EPSG:4326")}readFeaturesFromNode(t,e){if(e=this.getReadOptions(t,e),"osm"==t.localName){const r=pushParseAndPop({nodes:{},ways:[],features:[]},PARSERS,t,[e]);for(let t=0;t<r.ways.length;t++){const o=r.ways[t],s=o.flatCoordinates;if(!s.length)for(let t=0,e=o.ndrefs.length;t<e;t++){const e=r.nodes[o.ndrefs[t]];extend(s,e)}let n;n=o.ndrefs[0]==o.ndrefs[o.ndrefs.length-1]?new Polygon(s,"XY",[s.length]):new LineString(s,"XY"),transformGeometryWithOptions(n,!1,e);const a=new Feature(n);void 0!==o.id&&a.setId(o.id),a.setProperties(o.tags,!0),r.features.push(a)}if(r.features)return r.features}return[]}}const NODE_PARSERS=makeStructureNS(NAMESPACE_URIS,{tag:readTag});function readNode(t,e){const r=e[0],o=e[e.length-1],s=t.getAttribute("id"),n=[parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))];o.nodes[s]=n;const a=pushParseAndPop({tags:{}},NODE_PARSERS,t,e);if(!isEmpty(a.tags)){const t=new Point(n);transformGeometryWithOptions(t,!1,r);const e=new Feature(t);void 0!==s&&e.setId(s),e.setProperties(a.tags,!0),o.features.push(e)}}function readWay(t,e){const r=t.getAttribute("id"),o=pushParseAndPop({id:r,ndrefs:[],flatCoordinates:[],tags:{}},WAY_PARSERS,t,e);e[e.length-1].ways.push(o)}function readNd(t,e){const r=e[e.length-1];r.ndrefs.push(t.getAttribute("ref")),t.hasAttribute("lon")&&t.hasAttribute("lat")&&(r.flatCoordinates.push(parseFloat(t.getAttribute("lon"))),r.flatCoordinates.push(parseFloat(t.getAttribute("lat"))))}function readTag(t,e){e[e.length-1].tags[t.getAttribute("k")]=t.getAttribute("v")}export default OSMXML;
//# sourceMappingURL=/sm/7eeec8d4bf80914f5b41326ac564889073fcd988a49314af501e762a5beaa99f.map