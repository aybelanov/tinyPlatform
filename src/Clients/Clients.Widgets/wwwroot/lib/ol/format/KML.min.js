/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/format/KML.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Feature from"../Feature.js";import Fill from"../style/Fill.js";import GeometryCollection from"../geom/GeometryCollection.js";import Icon from"../style/Icon.js";import ImageState from"../ImageState.js";import LineString from"../geom/LineString.js";import MultiLineString from"../geom/MultiLineString.js";import MultiPoint from"../geom/MultiPoint.js";import MultiPolygon from"../geom/MultiPolygon.js";import Point from"../geom/Point.js";import Polygon from"../geom/Polygon.js";import Stroke from"../style/Stroke.js";import Style from"../style/Style.js";import Text from"../style/Text.js";import XMLFeature from"./XMLFeature.js";import{OBJECT_PROPERTY_NODE_FACTORY,XML_SCHEMA_INSTANCE_URI,createElementNS,getAllTextContent,isDocument,makeArrayExtender,makeArrayPusher,makeChildAppender,makeObjectPropertySetter,makeReplacer,makeSequence,makeSimpleNodeFactory,makeStructureNS,parse,parseNode,pushParseAndPop,pushSerializeAndPop}from"../xml.js";import{asArray}from"../color.js";import{extend}from"../array.js";import{get as getProjection}from"../proj.js";import{readBoolean,readDecimal,readString,writeBooleanTextNode,writeCDATASection,writeDecimalTextNode,writeStringTextNode}from"./xsd.js";import{toRadians}from"../math.js";import{transformGeometryWithOptions}from"./Feature.js";const GX_NAMESPACE_URIS=["http://www.google.com/kml/ext/2.2"],NAMESPACE_URIS=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],SCHEMA_LOCATION="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",ICON_ANCHOR_UNITS_MAP={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},PLACEMARK_PARSERS=makeStructureNS(NAMESPACE_URIS,{ExtendedData:extendedDataParser,Region:regionParser,MultiGeometry:makeObjectPropertySetter(readMultiGeometry,"geometry"),LineString:makeObjectPropertySetter(readLineString,"geometry"),LinearRing:makeObjectPropertySetter(readLinearRing,"geometry"),Point:makeObjectPropertySetter(readPoint,"geometry"),Polygon:makeObjectPropertySetter(readPolygon,"geometry"),Style:makeObjectPropertySetter(readStyle),StyleMap:placemarkStyleMapParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readStyleURL),visibility:makeObjectPropertySetter(readBoolean)},makeStructureNS(GX_NAMESPACE_URIS,{MultiTrack:makeObjectPropertySetter(readGxMultiTrack,"geometry"),Track:makeObjectPropertySetter(readGxTrack,"geometry")})),NETWORK_LINK_PARSERS=makeStructureNS(NAMESPACE_URIS,{ExtendedData:extendedDataParser,Region:regionParser,Link:linkParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),visibility:makeObjectPropertySetter(readBoolean)}),LINK_PARSERS=makeStructureNS(NAMESPACE_URIS,{href:makeObjectPropertySetter(readURI)}),CAMERA_PARSERS=makeStructureNS(NAMESPACE_URIS,{Altitude:makeObjectPropertySetter(readDecimal),Longitude:makeObjectPropertySetter(readDecimal),Latitude:makeObjectPropertySetter(readDecimal),Tilt:makeObjectPropertySetter(readDecimal),AltitudeMode:makeObjectPropertySetter(readString),Heading:makeObjectPropertySetter(readDecimal),Roll:makeObjectPropertySetter(readDecimal)}),REGION_PARSERS=makeStructureNS(NAMESPACE_URIS,{LatLonAltBox:latLonAltBoxParser,Lod:lodParser}),KML_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["Document","Placemark"]),KML_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Document:makeChildAppender(writeDocument),Placemark:makeChildAppender(writePlacemark)});let DEFAULT_COLOR,DEFAULT_IMAGE_STYLE_ANCHOR,DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,DEFAULT_IMAGE_STYLE_SIZE,DEFAULT_IMAGE_STYLE_SRC,DEFAULT_FILL_STYLE=null;export function getDefaultFillStyle(){return DEFAULT_FILL_STYLE}let DEFAULT_NO_IMAGE_STYLE,DEFAULT_IMAGE_STYLE=null;export function getDefaultImageStyle(){return DEFAULT_IMAGE_STYLE}let DEFAULT_TEXT_STROKE_STYLE,DEFAULT_STROKE_STYLE=null;export function getDefaultStrokeStyle(){return DEFAULT_STROKE_STYLE}let DEFAULT_TEXT_STYLE=null;export function getDefaultTextStyle(){return DEFAULT_TEXT_STYLE}let DEFAULT_STYLE=null;export function getDefaultStyle(){return DEFAULT_STYLE}let TEXTAREA,DEFAULT_STYLE_ARRAY=null;export function getDefaultStyleArray(){return DEFAULT_STYLE_ARRAY}function scaleForSize(e){return 32/Math.min(e[0],e[1])}function createStyleDefaults(){DEFAULT_COLOR=[255,255,255,1],DEFAULT_FILL_STYLE=new Fill({color:DEFAULT_COLOR}),DEFAULT_IMAGE_STYLE_ANCHOR=[20,2],DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS="pixels",DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS="pixels",DEFAULT_IMAGE_STYLE_SIZE=[64,64],DEFAULT_IMAGE_STYLE_SRC="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",DEFAULT_IMAGE_STYLE=new Icon({anchor:DEFAULT_IMAGE_STYLE_ANCHOR,anchorOrigin:"bottom-left",anchorXUnits:DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,anchorYUnits:DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,crossOrigin:"anonymous",rotation:0,scale:scaleForSize(DEFAULT_IMAGE_STYLE_SIZE),size:DEFAULT_IMAGE_STYLE_SIZE,src:DEFAULT_IMAGE_STYLE_SRC}),DEFAULT_NO_IMAGE_STYLE="NO_IMAGE",DEFAULT_STROKE_STYLE=new Stroke({color:DEFAULT_COLOR,width:1}),DEFAULT_TEXT_STROKE_STYLE=new Stroke({color:[51,51,51,1],width:2}),DEFAULT_TEXT_STYLE=new Text({font:"bold 16px Helvetica",fill:DEFAULT_FILL_STYLE,stroke:DEFAULT_TEXT_STROKE_STYLE,scale:.8}),DEFAULT_STYLE=new Style({fill:DEFAULT_FILL_STYLE,image:DEFAULT_IMAGE_STYLE,text:DEFAULT_TEXT_STYLE,stroke:DEFAULT_STROKE_STYLE,zIndex:0}),DEFAULT_STYLE_ARRAY=[DEFAULT_STYLE]}function defaultIconUrlFunction(e){return e}class KML extends XMLFeature{constructor(e){super(),e=e||{},DEFAULT_STYLE_ARRAY||createStyleDefaults(),this.dataProjection=getProjection("EPSG:4326"),this.defaultStyle_=e.defaultStyle?e.defaultStyle:DEFAULT_STYLE_ARRAY,this.extractStyles_=void 0===e.extractStyles||e.extractStyles,this.writeStyles_=void 0===e.writeStyles||e.writeStyles,this.sharedStyles_={},this.showPointNames_=void 0===e.showPointNames||e.showPointNames,this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:"anonymous",this.iconUrlFunction_=e.iconUrlFunction?e.iconUrlFunction:defaultIconUrlFunction,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(e,t){const r=makeStructureNS(NAMESPACE_URIS,{Document:makeArrayExtender(this.readDocumentOrFolder_,this),Folder:makeArrayExtender(this.readDocumentOrFolder_,this),Placemark:makeArrayPusher(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),n=pushParseAndPop([],r,e,t,this);if(n)return n}readPlacemark_(e,t){const r=pushParseAndPop({geometry:null},PLACEMARK_PARSERS,e,t,this);if(!r)return;const n=new Feature,o=e.getAttribute("id");null!==o&&n.setId(o);const i=t[0],a=r.geometry;if(a&&transformGeometryWithOptions(a,!1,i),n.setGeometry(a),delete r.geometry,this.extractStyles_){const e=createFeatureStyleFunction(r.Style,r.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(e)}return delete r.Style,n.setProperties(r,!0),n}readSharedStyle_(e,t){const r=e.getAttribute("id");if(null!==r){const n=readStyle.call(this,e,t);if(n){let t,o=e.baseURI;if(o&&"about:blank"!=o||(o=window.location.href),o){t=new URL("#"+r,o).href}else t="#"+r;this.sharedStyles_[t]=n}}}readSharedStyleMap_(e,t){const r=e.getAttribute("id");if(null===r)return;const n=readStyleMapValue.call(this,e,t);if(!n)return;let o,i=e.baseURI;if(i&&"about:blank"!=i||(i=window.location.href),i){o=new URL("#"+r,i).href}else o="#"+r;this.sharedStyles_[o]=n}readFeatureFromNode(e,t){if(!NAMESPACE_URIS.includes(e.namespaceURI))return null;const r=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return r||null}readFeaturesFromNode(e,t){if(!NAMESPACE_URIS.includes(e.namespaceURI))return[];let r;const n=e.localName;if("Document"==n||"Folder"==n)return r=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]),r||[];if("Placemark"==n){const r=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return r?[r]:[]}if("kml"==n){r=[];for(let n=e.firstElementChild;n;n=n.nextElementSibling){const e=this.readFeaturesFromNode(n,t);e&&extend(r,e)}return r}return[]}readName(e){if(e){if("string"==typeof e){const t=parse(e);return this.readNameFromDocument(t)}return isDocument(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}}readNameFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){const e=this.readNameFromNode(t);if(e)return e}}readNameFromNode(e){for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(NAMESPACE_URIS.includes(t.namespaceURI)&&"name"==t.localName)return readString(t);for(let t=e.firstElementChild;t;t=t.nextElementSibling){const e=t.localName;if(NAMESPACE_URIS.includes(t.namespaceURI)&&("Document"==e||"Folder"==e||"Placemark"==e||"kml"==e)){const e=this.readNameFromNode(t);if(e)return e}}}readNetworkLinks(e){const t=[];if("string"==typeof e){const r=parse(e);extend(t,this.readNetworkLinksFromDocument(r))}else isDocument(e)?extend(t,this.readNetworkLinksFromDocument(e)):extend(t,this.readNetworkLinksFromNode(e));return t}readNetworkLinksFromDocument(e){const t=[];for(let r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&extend(t,this.readNetworkLinksFromNode(r));return t}readNetworkLinksFromNode(e){const t=[];for(let r=e.firstElementChild;r;r=r.nextElementSibling)if(NAMESPACE_URIS.includes(r.namespaceURI)&&"NetworkLink"==r.localName){const e=pushParseAndPop({},NETWORK_LINK_PARSERS,r,[]);t.push(e)}for(let r=e.firstElementChild;r;r=r.nextElementSibling){const e=r.localName;!NAMESPACE_URIS.includes(r.namespaceURI)||"Document"!=e&&"Folder"!=e&&"kml"!=e||extend(t,this.readNetworkLinksFromNode(r))}return t}readRegion(e){const t=[];if("string"==typeof e){const r=parse(e);extend(t,this.readRegionFromDocument(r))}else isDocument(e)?extend(t,this.readRegionFromDocument(e)):extend(t,this.readRegionFromNode(e));return t}readRegionFromDocument(e){const t=[];for(let r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&extend(t,this.readRegionFromNode(r));return t}readRegionFromNode(e){const t=[];for(let r=e.firstElementChild;r;r=r.nextElementSibling)if(NAMESPACE_URIS.includes(r.namespaceURI)&&"Region"==r.localName){const e=pushParseAndPop({},REGION_PARSERS,r,[]);t.push(e)}for(let r=e.firstElementChild;r;r=r.nextElementSibling){const e=r.localName;!NAMESPACE_URIS.includes(r.namespaceURI)||"Document"!=e&&"Folder"!=e&&"kml"!=e||extend(t,this.readRegionFromNode(r))}return t}readCamera(e){const t=[];if("string"==typeof e){const r=parse(e);extend(t,this.readCameraFromDocument(r))}else isDocument(e)?extend(t,this.readCameraFromDocument(e)):extend(t,this.readCameraFromNode(e));return t}readCameraFromDocument(e){const t=[];for(let r=e.firstChild;r;r=r.nextSibling)r.nodeType===Node.ELEMENT_NODE&&extend(t,this.readCameraFromNode(r));return t}readCameraFromNode(e){const t=[];for(let r=e.firstElementChild;r;r=r.nextElementSibling)if(NAMESPACE_URIS.includes(r.namespaceURI)&&"Camera"===r.localName){const e=pushParseAndPop({},CAMERA_PARSERS,r,[]);t.push(e)}for(let r=e.firstElementChild;r;r=r.nextElementSibling){const e=r.localName;!NAMESPACE_URIS.includes(r.namespaceURI)||"Document"!==e&&"Folder"!==e&&"Placemark"!==e&&"kml"!==e||extend(t,this.readCameraFromNode(r))}return t}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=createElementNS(NAMESPACE_URIS[4],"kml"),n="http://www.w3.org/2000/xmlns/";r.setAttributeNS(n,"xmlns:gx",GX_NAMESPACE_URIS[0]),r.setAttributeNS(n,"xmlns:xsi",XML_SCHEMA_INSTANCE_URI),r.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATION);const o={node:r},i={};e.length>1?i.Document=e:1==e.length&&(i.Placemark=e[0]);const a=KML_SEQUENCE[r.namespaceURI],l=makeSequence(i,a);return pushSerializeAndPop(o,KML_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,l,[t],a,this),r}}function createNameStyleFunction(e,t){const r=[0,0];let n="start";const o=e.getImage();if(o){const e=o.getSize();if(e&&2==e.length){const t=o.getScaleArray(),i=o.getAnchor();r[0]=t[0]*(e[0]-i[0]),r[1]=t[1]*(e[1]/2-i[1]),n="left"}}let i=e.getText();i?(i=i.clone(),i.setFont(i.getFont()||DEFAULT_TEXT_STYLE.getFont()),i.setScale(i.getScale()||DEFAULT_TEXT_STYLE.getScale()),i.setFill(i.getFill()||DEFAULT_TEXT_STYLE.getFill()),i.setStroke(i.getStroke()||DEFAULT_TEXT_STROKE_STYLE)):i=DEFAULT_TEXT_STYLE.clone(),i.setText(t),i.setOffsetX(r[0]),i.setOffsetY(r[1]),i.setTextAlign(n);return new Style({image:o,text:i})}function createFeatureStyleFunction(e,t,r,n,o){return function(i,a){let l=o,S="",s=[];if(l){const e=i.getGeometry();if(e)if(e instanceof GeometryCollection)s=e.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"Point"===t||"MultiPoint"===t})),l=s.length>0;else{const t=e.getType();l="Point"===t||"MultiPoint"===t}}l&&(S=i.get("name"),l=l&&!!S,l&&/&[^&]+;/.test(S)&&(TEXTAREA||(TEXTAREA=document.createElement("textarea")),TEXTAREA.innerHTML=S,S=TEXTAREA.value));let E=r;if(e?E=e:t&&(E=findStyle(t,r,n)),l){const e=createNameStyleFunction(E[0],S);if(s.length>0){e.setGeometry(new GeometryCollection(s));return[e,new Style({geometry:E[0].getGeometry(),image:null,fill:E[0].getFill(),stroke:E[0].getStroke(),text:null})].concat(E.slice(1))}return e}return E}}function findStyle(e,t,r){return Array.isArray(e)?e:"string"==typeof e?findStyle(r[e],t,r):t}function readColor(e){const t=getAllTextContent(e,!1),r=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(r){const e=r[1];return[parseInt(e.substr(6,2),16),parseInt(e.substr(4,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(0,2),16)/255]}}export function readFlatCoordinates(e){let t=getAllTextContent(e,!1);const r=[];t=t.replace(/\s*,\s*/g,",");const n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let o;for(;o=n.exec(t);){const e=parseFloat(o[1]),n=parseFloat(o[2]),i=o[3]?parseFloat(o[3]):0;r.push(e,n,i),t=t.substr(o[0].length)}if(""===t)return r}function readURI(e){const t=getAllTextContent(e,!1).trim();let r=e.baseURI;if(r&&"about:blank"!=r||(r=window.location.href),r){return new URL(t,r).href}return t}function readStyleURL(e){const t=getAllTextContent(e,!1).trim().replace(/^(?!.*#)/,"#");let r=e.baseURI;if(r&&"about:blank"!=r||(r=window.location.href),r){return new URL(t,r).href}return t}function readVec2(e){const t=e.getAttribute("xunits"),r=e.getAttribute("yunits");let n;return n="insetPixels"!==t?"insetPixels"!==r?"bottom-left":"top-left":"insetPixels"!==r?"bottom-right":"top-right",{x:parseFloat(e.getAttribute("x")),xunits:ICON_ANCHOR_UNITS_MAP[t],y:parseFloat(e.getAttribute("y")),yunits:ICON_ANCHOR_UNITS_MAP[r],origin:n}}function readScale(e){return readDecimal(e)}const STYLE_MAP_PARSERS=makeStructureNS(NAMESPACE_URIS,{Pair:pairDataParser});function readStyleMapValue(e,t){return pushParseAndPop(void 0,STYLE_MAP_PARSERS,e,t,this)}const ICON_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{Icon:makeObjectPropertySetter(readIcon),color:makeObjectPropertySetter(readColor),heading:makeObjectPropertySetter(readDecimal),hotSpot:makeObjectPropertySetter(readVec2),scale:makeObjectPropertySetter(readScale)});function iconStyleParser(e,t){const r=pushParseAndPop({},ICON_STYLE_PARSERS,e,t);if(!r)return;const n=t[t.length-1],o="Icon"in r?r.Icon:{},i=!("Icon"in r)||Object.keys(o).length>0;let a;const l=o.href;let S,s,E;l?a=l:i&&(a=DEFAULT_IMAGE_STYLE_SRC);let c="bottom-left";const d=r.hotSpot;let A;d?(S=[d.x,d.y],s=d.xunits,E=d.yunits,c=d.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(a)&&(a.includes("pushpin")?(S=DEFAULT_IMAGE_STYLE_ANCHOR,s=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,E=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):a.includes("arrow-reverse")?(S=[54,42],s=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,E=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):a.includes("paddle")&&(S=[32,1],s=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,E=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS));const m=o.x,u=o.y;let _;void 0!==m&&void 0!==u&&(A=[m,u]);const R=o.w,p=o.h;let P;void 0!==R&&void 0!==p&&(_=[R,p]);const T=r.heading;void 0!==T&&(P=toRadians(T));const N=r.scale,y=r.color;if(i){a==DEFAULT_IMAGE_STYLE_SRC&&(_=DEFAULT_IMAGE_STYLE_SIZE);const e=new Icon({anchor:S,anchorOrigin:c,anchorXUnits:s,anchorYUnits:E,crossOrigin:this.crossOrigin_,offset:A,offsetOrigin:"bottom-left",rotation:P,scale:N,size:_,src:this.iconUrlFunction_(a),color:y}),t=e.getScaleArray()[0],r=e.getSize();if(null===r){const r=e.getImageState();if(r===ImageState.IDLE||r===ImageState.LOADING){const n=function(){const r=e.getImageState();if(r!==ImageState.IDLE&&r!==ImageState.LOADING){const r=e.getSize();if(r&&2==r.length){const n=scaleForSize(r);e.setScale(t*n)}e.unlistenImageChange(n)}};e.listenImageChange(n),r===ImageState.IDLE&&e.load()}}else if(2==r.length){const n=scaleForSize(r);e.setScale(t*n)}n.imageStyle=e}else n.imageStyle=DEFAULT_NO_IMAGE_STYLE}const LABEL_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{color:makeObjectPropertySetter(readColor),scale:makeObjectPropertySetter(readScale)});function labelStyleParser(e,t){const r=pushParseAndPop({},LABEL_STYLE_PARSERS,e,t);if(!r)return;const n=t[t.length-1],o=new Text({fill:new Fill({color:"color"in r?r.color:DEFAULT_COLOR}),scale:r.scale});n.textStyle=o}const LINE_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{color:makeObjectPropertySetter(readColor),width:makeObjectPropertySetter(readDecimal)});function lineStyleParser(e,t){const r=pushParseAndPop({},LINE_STYLE_PARSERS,e,t);if(!r)return;const n=t[t.length-1],o=new Stroke({color:"color"in r?r.color:DEFAULT_COLOR,width:"width"in r?r.width:1});n.strokeStyle=o}const POLY_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{color:makeObjectPropertySetter(readColor),fill:makeObjectPropertySetter(readBoolean),outline:makeObjectPropertySetter(readBoolean)});function polyStyleParser(e,t){const r=pushParseAndPop({},POLY_STYLE_PARSERS,e,t);if(!r)return;const n=t[t.length-1],o=new Fill({color:"color"in r?r.color:DEFAULT_COLOR});n.fillStyle=o;const i=r.fill;void 0!==i&&(n.fill=i);const a=r.outline;void 0!==a&&(n.outline=a)}const FLAT_LINEAR_RING_PARSERS=makeStructureNS(NAMESPACE_URIS,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatLinearRing(e,t){return pushParseAndPop(null,FLAT_LINEAR_RING_PARSERS,e,t)}function gxCoordParser(e,t){const r=t[t.length-1].coordinates,n=getAllTextContent(e,!1),o=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(o){const e=parseFloat(o[1]),t=parseFloat(o[2]),n=parseFloat(o[3]);r.push([e,t,n])}else r.push([])}const GX_MULTITRACK_GEOMETRY_PARSERS=makeStructureNS(GX_NAMESPACE_URIS,{Track:makeArrayPusher(readGxTrack)});function readGxMultiTrack(e,t){const r=pushParseAndPop([],GX_MULTITRACK_GEOMETRY_PARSERS,e,t);if(r)return new MultiLineString(r)}const GX_TRACK_PARSERS=makeStructureNS(NAMESPACE_URIS,{when:whenParser},makeStructureNS(GX_NAMESPACE_URIS,{coord:gxCoordParser}));function readGxTrack(e,t){const r=pushParseAndPop({coordinates:[],whens:[]},GX_TRACK_PARSERS,e,t);if(!r)return;const n=[],o=r.coordinates,i=r.whens;for(let e=0,t=Math.min(o.length,i.length);e<t;++e)3==o[e].length&&n.push(o[e][0],o[e][1],o[e][2],i[e]);return new LineString(n,"XYZM")}const ICON_PARSERS=makeStructureNS(NAMESPACE_URIS,{href:makeObjectPropertySetter(readURI)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeObjectPropertySetter(readDecimal),y:makeObjectPropertySetter(readDecimal),w:makeObjectPropertySetter(readDecimal),h:makeObjectPropertySetter(readDecimal)}));function readIcon(e,t){const r=pushParseAndPop({},ICON_PARSERS,e,t);return r||null}const GEOMETRY_FLAT_COORDINATES_PARSERS=makeStructureNS(NAMESPACE_URIS,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatCoordinatesFromNode(e,t){return pushParseAndPop(null,GEOMETRY_FLAT_COORDINATES_PARSERS,e,t)}const EXTRUDE_AND_ALTITUDE_MODE_PARSERS=makeStructureNS(NAMESPACE_URIS,{extrude:makeObjectPropertySetter(readBoolean),tessellate:makeObjectPropertySetter(readBoolean),altitudeMode:makeObjectPropertySetter(readString)});function readLineString(e,t){const r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),n=readFlatCoordinatesFromNode(e,t);if(n){const e=new LineString(n,"XYZ");return e.setProperties(r,!0),e}}function readLinearRing(e,t){const r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),n=readFlatCoordinatesFromNode(e,t);if(n){const e=new Polygon(n,"XYZ",[n.length]);return e.setProperties(r,!0),e}}const MULTI_GEOMETRY_PARSERS=makeStructureNS(NAMESPACE_URIS,{LineString:makeArrayPusher(readLineString),LinearRing:makeArrayPusher(readLinearRing),MultiGeometry:makeArrayPusher(readMultiGeometry),Point:makeArrayPusher(readPoint),Polygon:makeArrayPusher(readPolygon)});function readMultiGeometry(e,t){const r=pushParseAndPop([],MULTI_GEOMETRY_PARSERS,e,t);if(!r)return null;if(0===r.length)return new GeometryCollection(r);let n,o=!0;const i=r[0].getType();let a;for(let e=1,t=r.length;e<t;++e)if(a=r[e],a.getType()!=i){o=!1;break}if(o){let e,t;if("Point"==i){const o=r[0];e=o.getLayout(),t=o.getFlatCoordinates();for(let e=1,n=r.length;e<n;++e)a=r[e],extend(t,a.getFlatCoordinates());n=new MultiPoint(t,e),setCommonGeometryProperties(n,r)}else if("LineString"==i)n=new MultiLineString(r),setCommonGeometryProperties(n,r);else if("Polygon"==i)n=new MultiPolygon(r),setCommonGeometryProperties(n,r);else{if("GeometryCollection"!=i)throw new Error("Unknown geometry type found");n=new GeometryCollection(r)}}else n=new GeometryCollection(r);return n}function readPoint(e,t){const r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),n=readFlatCoordinatesFromNode(e,t);if(n){const e=new Point(n,"XYZ");return e.setProperties(r,!0),e}}const FLAT_LINEAR_RINGS_PARSERS=makeStructureNS(NAMESPACE_URIS,{innerBoundaryIs:innerBoundaryIsParser,outerBoundaryIs:outerBoundaryIsParser});function readPolygon(e,t){const r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),n=pushParseAndPop([null],FLAT_LINEAR_RINGS_PARSERS,e,t);if(n&&n[0]){const e=n[0],t=[e.length];for(let r=1,o=n.length;r<o;++r)extend(e,n[r]),t.push(e.length);const o=new Polygon(e,"XYZ",t);return o.setProperties(r,!0),o}}const STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{IconStyle:iconStyleParser,LabelStyle:labelStyleParser,LineStyle:lineStyleParser,PolyStyle:polyStyleParser});function readStyle(e,t){const r=pushParseAndPop({},STYLE_PARSERS,e,t,this);if(!r)return null;let n="fillStyle"in r?r.fillStyle:DEFAULT_FILL_STYLE;const o=r.fill;let i;void 0===o||o||(n=null),"imageStyle"in r?r.imageStyle!=DEFAULT_NO_IMAGE_STYLE&&(i=r.imageStyle):i=DEFAULT_IMAGE_STYLE;const a="textStyle"in r?r.textStyle:DEFAULT_TEXT_STYLE,l="strokeStyle"in r?r.strokeStyle:DEFAULT_STROKE_STYLE,S=r.outline;return void 0===S||S?[new Style({fill:n,image:i,stroke:l,text:a,zIndex:void 0})]:[new Style({geometry:function(e){const t=e.getGeometry(),r=t.getType();if("GeometryCollection"===r){return new GeometryCollection(t.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"Polygon"!==t&&"MultiPolygon"!==t})))}if("Polygon"!==r&&"MultiPolygon"!==r)return t},fill:n,image:i,stroke:l,text:a,zIndex:void 0}),new Style({geometry:function(e){const t=e.getGeometry(),r=t.getType();if("GeometryCollection"===r){return new GeometryCollection(t.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"Polygon"===t||"MultiPolygon"===t})))}if("Polygon"===r||"MultiPolygon"===r)return t},fill:n,stroke:null,zIndex:void 0})]}function setCommonGeometryProperties(e,t){const r=t.length,n=new Array(t.length),o=new Array(t.length),i=new Array(t.length);let a,l,S;a=!1,l=!1,S=!1;for(let e=0;e<r;++e){const r=t[e];n[e]=r.get("extrude"),o[e]=r.get("tessellate"),i[e]=r.get("altitudeMode"),a=a||void 0!==n[e],l=l||void 0!==o[e],S=S||i[e]}a&&e.set("extrude",n),l&&e.set("tessellate",o),S&&e.set("altitudeMode",i)}const DATA_PARSERS=makeStructureNS(NAMESPACE_URIS,{displayName:makeObjectPropertySetter(readString),value:makeObjectPropertySetter(readString)});function dataParser(e,t){const r=e.getAttribute("name");parseNode(DATA_PARSERS,e,t);const n=t[t.length-1];r&&n.displayName?n[r]={value:n.value,displayName:n.displayName,toString:function(){return n.value}}:null!==r?n[r]=n.value:null!==n.displayName&&(n[n.displayName]=n.value),delete n.value}const EXTENDED_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS,{Data:dataParser,SchemaData:schemaDataParser});function extendedDataParser(e,t){parseNode(EXTENDED_DATA_PARSERS,e,t)}function regionParser(e,t){parseNode(REGION_PARSERS,e,t)}const PAIR_PARSERS=makeStructureNS(NAMESPACE_URIS,{Style:makeObjectPropertySetter(readStyle),key:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readStyleURL)});function pairDataParser(e,t){const r=pushParseAndPop({},PAIR_PARSERS,e,t,this);if(!r)return;const n=r.key;if(n&&"normal"==n){const e=r.styleUrl;e&&(t[t.length-1]=e);const n=r.Style;n&&(t[t.length-1]=n)}}function placemarkStyleMapParser(e,t){const r=readStyleMapValue.call(this,e,t);if(!r)return;const n=t[t.length-1];if(Array.isArray(r))n.Style=r;else{if("string"!=typeof r)throw new Error("`styleMapValue` has an unknown type");n.styleUrl=r}}const SCHEMA_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS,{SimpleData:simpleDataParser});function schemaDataParser(e,t){parseNode(SCHEMA_DATA_PARSERS,e,t)}function simpleDataParser(e,t){const r=e.getAttribute("name");if(null!==r){const n=readString(e);t[t.length-1][r]=n}}const LAT_LON_ALT_BOX_PARSERS=makeStructureNS(NAMESPACE_URIS,{altitudeMode:makeObjectPropertySetter(readString),minAltitude:makeObjectPropertySetter(readDecimal),maxAltitude:makeObjectPropertySetter(readDecimal),north:makeObjectPropertySetter(readDecimal),south:makeObjectPropertySetter(readDecimal),east:makeObjectPropertySetter(readDecimal),west:makeObjectPropertySetter(readDecimal)});function latLonAltBoxParser(e,t){const r=pushParseAndPop({},LAT_LON_ALT_BOX_PARSERS,e,t);if(!r)return;const n=t[t.length-1],o=[parseFloat(r.west),parseFloat(r.south),parseFloat(r.east),parseFloat(r.north)];n.extent=o,n.altitudeMode=r.altitudeMode,n.minAltitude=parseFloat(r.minAltitude),n.maxAltitude=parseFloat(r.maxAltitude)}const LOD_PARSERS=makeStructureNS(NAMESPACE_URIS,{minLodPixels:makeObjectPropertySetter(readDecimal),maxLodPixels:makeObjectPropertySetter(readDecimal),minFadeExtent:makeObjectPropertySetter(readDecimal),maxFadeExtent:makeObjectPropertySetter(readDecimal)});function lodParser(e,t){const r=pushParseAndPop({},LOD_PARSERS,e,t);if(!r)return;const n=t[t.length-1];n.minLodPixels=parseFloat(r.minLodPixels),n.maxLodPixels=parseFloat(r.maxLodPixels),n.minFadeExtent=parseFloat(r.minFadeExtent),n.maxFadeExtent=parseFloat(r.maxFadeExtent)}const INNER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS,{LinearRing:makeArrayPusher(readFlatLinearRing)});function innerBoundaryIsParser(e,t){const r=pushParseAndPop([],INNER_BOUNDARY_IS_PARSERS,e,t);if(r.length>0){t[t.length-1].push(...r)}}const OUTER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS,{LinearRing:makeReplacer(readFlatLinearRing)});function outerBoundaryIsParser(e,t){const r=pushParseAndPop(void 0,OUTER_BOUNDARY_IS_PARSERS,e,t);if(r){t[t.length-1][0]=r}}function linkParser(e,t){parseNode(LINK_PARSERS,e,t)}function whenParser(e,t){const r=t[t.length-1].whens,n=getAllTextContent(e,!1),o=Date.parse(n);r.push(isNaN(o)?0:o)}function writeColorTextNode(e,t){const r=asArray(t),n=[255*(4==r.length?r[3]:1),r[2],r[1],r[0]];for(let e=0;e<4;++e){const t=Math.floor(n[e]).toString(16);n[e]=1==t.length?"0"+t:t}writeStringTextNode(e,n.join(""))}function writeCoordinatesTextNode(e,t,r){const n=r[r.length-1],o=n.layout,i=n.stride;let a;if("XY"==o||"XYM"==o)a=2;else{if("XYZ"!=o&&"XYZM"!=o)throw new Error("Invalid geometry layout");a=3}const l=t.length;let S="";if(l>0){S+=t[0];for(let e=1;e<a;++e)S+=","+t[e];for(let e=i;e<l;e+=i){S+=" "+t[e];for(let r=1;r<a;++r)S+=","+t[e+r]}}writeStringTextNode(e,S)}const EXTENDEDDATA_NODE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Data:makeChildAppender(writeDataNode),value:makeChildAppender(writeDataNodeValue),displayName:makeChildAppender(writeDataNodeName)});function writeDataNode(e,t,r){e.setAttribute("name",t.name);const n={node:e},o=t.value;"object"==typeof o?(null!==o&&o.displayName&&pushSerializeAndPop(n,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o.displayName],r,["displayName"]),null!==o&&o.value&&pushSerializeAndPop(n,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o.value],r,["value"])):pushSerializeAndPop(n,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o],r,["value"])}function writeDataNodeName(e,t){writeCDATASection(e,t)}function writeDataNodeValue(e,t){writeStringTextNode(e,t)}const DOCUMENT_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Placemark:makeChildAppender(writePlacemark)}),DOCUMENT_NODE_FACTORY=function(e,t,r){const n=t[t.length-1].node;return createElementNS(n.namespaceURI,"Placemark")};function writeDocument(e,t,r){pushSerializeAndPop({node:e},DOCUMENT_SERIALIZERS,DOCUMENT_NODE_FACTORY,t,r,void 0,this)}const DATA_NODE_FACTORY=makeSimpleNodeFactory("Data");function writeExtendedData(e,t,r){const n={node:e},o=t.names,i=t.values,a=o.length;for(let e=0;e<a;e++)pushSerializeAndPop(n,EXTENDEDDATA_NODE_SERIALIZERS,DATA_NODE_FACTORY,[{name:o[e],value:i[e]}],r)}const ICON_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["href"],makeStructureNS(GX_NAMESPACE_URIS,["x","y","w","h"])),ICON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{href:makeChildAppender(writeStringTextNode)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeChildAppender(writeDecimalTextNode),y:makeChildAppender(writeDecimalTextNode),w:makeChildAppender(writeDecimalTextNode),h:makeChildAppender(writeDecimalTextNode)})),GX_NODE_FACTORY=function(e,t,r){return createElementNS(GX_NAMESPACE_URIS[0],"gx:"+r)};function writeIcon(e,t,r){const n={node:e},o=r[r.length-1].node;let i=ICON_SEQUENCE[o.namespaceURI],a=makeSequence(t,i);pushSerializeAndPop(n,ICON_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,a,r,i),i=ICON_SEQUENCE[GX_NAMESPACE_URIS[0]],a=makeSequence(t,i),pushSerializeAndPop(n,ICON_SERIALIZERS,GX_NODE_FACTORY,a,r,i)}const ICON_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["scale","heading","Icon","color","hotSpot"]),ICON_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Icon:makeChildAppender(writeIcon),color:makeChildAppender(writeColorTextNode),heading:makeChildAppender(writeDecimalTextNode),hotSpot:makeChildAppender(writeVec2),scale:makeChildAppender(writeScaleTextNode)});function writeIconStyle(e,t,r){const n={node:e},o={},i=t.getSrc(),a=t.getSize(),l=t.getImageSize(),S={href:i};if(a){S.w=a[0],S.h=a[1];const e=t.getAnchor(),r=t.getOrigin();if(r&&l&&0!==r[0]&&r[1]!==a[1]&&(S.x=r[0],S.y=l[1]-(r[1]+a[1])),e&&(e[0]!==a[0]/2||e[1]!==a[1]/2)){const t={x:e[0],xunits:"pixels",y:a[1]-e[1],yunits:"pixels"};o.hotSpot=t}}o.Icon=S;let s=t.getScaleArray()[0],E=a;if(null===E&&(E=DEFAULT_IMAGE_STYLE_SIZE),2==E.length){s/=scaleForSize(E)}1!==s&&(o.scale=s);const c=t.getRotation();0!==c&&(o.heading=c);const d=t.getColor();d&&(o.color=d);const A=r[r.length-1].node,m=ICON_STYLE_SEQUENCE[A.namespaceURI],u=makeSequence(o,m);pushSerializeAndPop(n,ICON_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,u,r,m)}const LABEL_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["color","scale"]),LABEL_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{color:makeChildAppender(writeColorTextNode),scale:makeChildAppender(writeScaleTextNode)});function writeLabelStyle(e,t,r){const n={node:e},o={},i=t.getFill();i&&(o.color=i.getColor());const a=t.getScale();a&&1!==a&&(o.scale=a);const l=r[r.length-1].node,S=LABEL_STYLE_SEQUENCE[l.namespaceURI],s=makeSequence(o,S);pushSerializeAndPop(n,LABEL_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,s,r,S)}const LINE_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["color","width"]),LINE_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{color:makeChildAppender(writeColorTextNode),width:makeChildAppender(writeDecimalTextNode)});function writeLineStyle(e,t,r){const n={node:e},o={color:t.getColor(),width:Number(t.getWidth())||1},i=r[r.length-1].node,a=LINE_STYLE_SEQUENCE[i.namespaceURI],l=makeSequence(o,a);pushSerializeAndPop(n,LINE_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,l,r,a)}const GEOMETRY_TYPE_TO_NODENAME={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},GEOMETRY_NODE_FACTORY=function(e,t,r){if(e){const r=t[t.length-1].node;return createElementNS(r.namespaceURI,GEOMETRY_TYPE_TO_NODENAME[e.getType()])}},POINT_NODE_FACTORY=makeSimpleNodeFactory("Point"),LINE_STRING_NODE_FACTORY=makeSimpleNodeFactory("LineString"),LINEAR_RING_NODE_FACTORY=makeSimpleNodeFactory("LinearRing"),POLYGON_NODE_FACTORY=makeSimpleNodeFactory("Polygon"),MULTI_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{LineString:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),GeometryCollection:makeChildAppender(writeMultiGeometry)});function writeMultiGeometry(e,t,r){const n={node:e},o=t.getType();let i,a=[];if("GeometryCollection"===o)t.getGeometriesArrayRecursive().forEach((function(e){const t=e.getType();if("MultiPoint"===t)a=a.concat(e.getPoints());else if("MultiLineString"===t)a=a.concat(e.getLineStrings());else if("MultiPolygon"===t)a=a.concat(e.getPolygons());else{if("Point"!==t&&"LineString"!==t&&"Polygon"!==t)throw new Error("Unknown geometry type");a.push(e)}})),i=GEOMETRY_NODE_FACTORY;else if("MultiPoint"===o)a=t.getPoints(),i=POINT_NODE_FACTORY;else if("MultiLineString"===o)a=t.getLineStrings(),i=LINE_STRING_NODE_FACTORY;else{if("MultiPolygon"!==o)throw new Error("Unknown geometry type");a=t.getPolygons(),i=POLYGON_NODE_FACTORY}pushSerializeAndPop(n,MULTI_GEOMETRY_SERIALIZERS,i,a,r)}const BOUNDARY_IS_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{LinearRing:makeChildAppender(writePrimitiveGeometry)});function writeBoundaryIs(e,t,r){pushSerializeAndPop({node:e},BOUNDARY_IS_SERIALIZERS,LINEAR_RING_NODE_FACTORY,[t],r)}const PLACEMARK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{ExtendedData:makeChildAppender(writeExtendedData),MultiGeometry:makeChildAppender(writeMultiGeometry),LineString:makeChildAppender(writePrimitiveGeometry),LinearRing:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),Style:makeChildAppender(writeStyle),address:makeChildAppender(writeStringTextNode),description:makeChildAppender(writeStringTextNode),name:makeChildAppender(writeStringTextNode),open:makeChildAppender(writeBooleanTextNode),phoneNumber:makeChildAppender(writeStringTextNode),styleUrl:makeChildAppender(writeStringTextNode),visibility:makeChildAppender(writeBooleanTextNode)}),PLACEMARK_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),EXTENDEDDATA_NODE_FACTORY=makeSimpleNodeFactory("ExtendedData");function writePlacemark(e,t,r){const n={node:e};t.getId()&&e.setAttribute("id",t.getId());const o=t.getProperties(),i={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};i[t.getGeometryName()]=1;const a=Object.keys(o||{}).sort().filter((function(e){return!i[e]})),l=t.getStyleFunction();if(l){const e=l(t,0);if(e){const r=Array.isArray(e)?e:[e];let n=r;if(t.getGeometry()&&(n=r.filter((function(e){const r=e.getGeometryFunction()(t);if(r){const e=r.getType();return"GeometryCollection"===e?r.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"Point"===t||"MultiPoint"===t})).length:"Point"===e||"MultiPoint"===e}}))),this.writeStyles_){let e=r,i=r;t.getGeometry()&&(e=r.filter((function(e){const r=e.getGeometryFunction()(t);if(r){const e=r.getType();return"GeometryCollection"===e?r.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"LineString"===t||"MultiLineString"===t})).length:"LineString"===e||"MultiLineString"===e}})),i=r.filter((function(e){const r=e.getGeometryFunction()(t);if(r){const e=r.getType();return"GeometryCollection"===e?r.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"Polygon"===t||"MultiPolygon"===t})).length:"Polygon"===e||"MultiPolygon"===e}}))),o.Style={pointStyles:n,lineStyles:e,polyStyles:i}}if(n.length&&void 0===o.name){const e=n[0].getText();e&&(o.name=e.getText())}}}const S=r[r.length-1].node,s=PLACEMARK_SEQUENCE[S.namespaceURI],E=makeSequence(o,s);if(pushSerializeAndPop(n,PLACEMARK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,E,r,s),a.length>0){const e=makeSequence(o,a);pushSerializeAndPop(n,PLACEMARK_SERIALIZERS,EXTENDEDDATA_NODE_FACTORY,[{names:a,values:e}],r)}const c=r[0];let d=t.getGeometry();d&&(d=transformGeometryWithOptions(d,!0,c)),pushSerializeAndPop(n,PLACEMARK_SERIALIZERS,GEOMETRY_NODE_FACTORY,[d],r)}const PRIMITIVE_GEOMETRY_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["extrude","tessellate","altitudeMode","coordinates"]),PRIMITIVE_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{extrude:makeChildAppender(writeBooleanTextNode),tessellate:makeChildAppender(writeBooleanTextNode),altitudeMode:makeChildAppender(writeStringTextNode),coordinates:makeChildAppender(writeCoordinatesTextNode)});function writePrimitiveGeometry(e,t,r){const n=t.getFlatCoordinates(),o={node:e};o.layout=t.getLayout(),o.stride=t.getStride();const i=t.getProperties();i.coordinates=n;const a=r[r.length-1].node,l=PRIMITIVE_GEOMETRY_SEQUENCE[a.namespaceURI],S=makeSequence(i,l);pushSerializeAndPop(o,PRIMITIVE_GEOMETRY_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,S,r,l)}const POLY_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["color","fill","outline"]),POLYGON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{outerBoundaryIs:makeChildAppender(writeBoundaryIs),innerBoundaryIs:makeChildAppender(writeBoundaryIs)}),INNER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("innerBoundaryIs"),OUTER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("outerBoundaryIs");function writePolygon(e,t,r){const n=t.getLinearRings(),o=n.shift(),i={node:e};pushSerializeAndPop(i,POLYGON_SERIALIZERS,INNER_BOUNDARY_NODE_FACTORY,n,r),pushSerializeAndPop(i,POLYGON_SERIALIZERS,OUTER_BOUNDARY_NODE_FACTORY,[o],r)}const POLY_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{color:makeChildAppender(writeColorTextNode),fill:makeChildAppender(writeBooleanTextNode),outline:makeChildAppender(writeBooleanTextNode)});function writePolyStyle(e,t,r){const n={node:e},o=t.getFill(),i=t.getStroke(),a={color:o?o.getColor():void 0,fill:!!o&&void 0,outline:!!i&&void 0},l=r[r.length-1].node,S=POLY_STYLE_SEQUENCE[l.namespaceURI],s=makeSequence(a,S);pushSerializeAndPop(n,POLY_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,s,r,S)}function writeScaleTextNode(e,t){writeDecimalTextNode(e,Math.round(1e6*t)/1e6)}const STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{IconStyle:makeChildAppender(writeIconStyle),LabelStyle:makeChildAppender(writeLabelStyle),LineStyle:makeChildAppender(writeLineStyle),PolyStyle:makeChildAppender(writePolyStyle)});function writeStyle(e,t,r){const n={node:e},o={};if(t.pointStyles.length){const e=t.pointStyles[0].getText();e&&(o.LabelStyle=e);const r=t.pointStyles[0].getImage();r&&"function"==typeof r.getSrc&&(o.IconStyle=r)}if(t.lineStyles.length){const e=t.lineStyles[0].getStroke();e&&(o.LineStyle=e)}if(t.polyStyles.length){const e=t.polyStyles[0].getStroke();e&&!o.LineStyle&&(o.LineStyle=e),o.PolyStyle=t.polyStyles[0]}const i=r[r.length-1].node,a=STYLE_SEQUENCE[i.namespaceURI],l=makeSequence(o,a);pushSerializeAndPop(n,STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,l,r,a)}function writeVec2(e,t){e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("xunits",t.xunits),e.setAttribute("yunits",t.yunits)}export default KML;
//# sourceMappingURL=/sm/53526dee8e82c10301e3f658c129a5f0e016081719ef96fdfb65be5c96d62575.map