/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/format/WFS.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import GML2 from"./GML2.js";import GML3 from"./GML3.js";import GML32 from"./GML32.js";import GMLBase,{GMLNS}from"./GMLBase.js";import XMLFeature from"./XMLFeature.js";import{XML_SCHEMA_INSTANCE_URI,createElementNS,isDocument,makeArrayPusher,makeChildAppender,makeObjectPropertySetter,makeSimpleNodeFactory,parse,parseNode,pushParseAndPop,pushSerializeAndPop}from"../xml.js";import{and as andFilterFn,bbox as bboxFilterFn}from"./filter.js";import{assert}from"../asserts.js";import{get as getProjection}from"../proj.js";import{readNonNegativeIntegerString,readPositiveInteger,writeStringTextNode}from"./xsd.js";const FEATURE_COLLECTION_PARSERS={"http://www.opengis.net/gml":{boundedBy:makeObjectPropertySetter(GMLBase.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:makeArrayPusher(GMLBase.prototype.readFeaturesInternal)}},TRANSACTION_SUMMARY_PARSERS={"http://www.opengis.net/wfs":{totalInserted:makeObjectPropertySetter(readPositiveInteger),totalUpdated:makeObjectPropertySetter(readPositiveInteger),totalDeleted:makeObjectPropertySetter(readPositiveInteger)},"http://www.opengis.net/wfs/2.0":{totalInserted:makeObjectPropertySetter(readPositiveInteger),totalUpdated:makeObjectPropertySetter(readPositiveInteger),totalDeleted:makeObjectPropertySetter(readPositiveInteger)}},TRANSACTION_RESPONSE_PARSERS={"http://www.opengis.net/wfs":{TransactionSummary:makeObjectPropertySetter(readTransactionSummary,"transactionSummary"),InsertResults:makeObjectPropertySetter(readInsertResults,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:makeObjectPropertySetter(readTransactionSummary,"transactionSummary"),InsertResults:makeObjectPropertySetter(readInsertResults,"insertIds")}},QUERY_SERIALIZERS={"http://www.opengis.net/wfs":{PropertyName:makeChildAppender(writeStringTextNode)},"http://www.opengis.net/wfs/2.0":{PropertyName:makeChildAppender(writeStringTextNode)}},TRANSACTION_SERIALIZERS={"http://www.opengis.net/wfs":{Insert:makeChildAppender(writeFeature),Update:makeChildAppender(writeUpdate),Delete:makeChildAppender(writeDelete),Property:makeChildAppender(writeProperty),Native:makeChildAppender(writeNative)},"http://www.opengis.net/wfs/2.0":{Insert:makeChildAppender(writeFeature),Update:makeChildAppender(writeUpdate),Delete:makeChildAppender(writeDelete),Property:makeChildAppender(writeProperty),Native:makeChildAppender(writeNative)}},FEATURE_PREFIX="feature",XMLNS="http://www.w3.org/2000/xmlns/",OGCNS={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},WFSNS={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},FESNS={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},SCHEMA_LOCATIONS={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},GML_FORMATS={"2.0.0":GML32,"1.1.0":GML3,"1.0.0":GML2},DEFAULT_VERSION="1.1.0";class WFS extends XMLFeature{constructor(e){super(),e=e||{},this.version_=e.version?e.version:"1.1.0",this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new GML_FORMATS[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:SCHEMA_LOCATIONS[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const r={node:e};Object.assign(r,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(r,this.getReadOptions(e,t||{}));const i=[r];let n;n="2.0.0"===this.version_?FEATURE_COLLECTION_PARSERS:this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=pushParseAndPop([],n,e,i,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if("string"==typeof e){const t=parse(e);return this.readTransactionResponseFromDocument(t)}return isDocument(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if("string"==typeof e){const t=parse(e);return this.readFeatureCollectionMetadataFromDocument(t)}return isDocument(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},r=readNonNegativeIntegerString(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=r,pushParseAndPop(t,FEATURE_COLLECTION_PARSERS,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return pushParseAndPop({},TRANSACTION_RESPONSE_PARSERS,e,[])}writeGetFeature(e){const t=createElementNS(WFSNS[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),void 0!==e.maxFeatures&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),void 0!==e.startIndex&&t.setAttribute("startIndex",String(e.startIndex)),void 0!==e.count&&t.setAttribute("count",String(e.count)),void 0!==e.viewParams&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",this.schemaLocation_);const r={node:t};if(Object.assign(r,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),assert(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),"string"==typeof e.featureTypes[0]){let i=e.filter;e.bbox&&(assert(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,i)),Object.assign(r,{geometryName:e.geometryName,filter:i}),writeGetFeature(t,e.featureTypes,[r])}else e.featureTypes.forEach((i=>{const n=this.combineBboxAndFilter(i.geometryName,i.bbox,e.srsName,e.filter);Object.assign(r,{geometryName:i.geometryName,filter:n}),writeGetFeature(t,[i.name],[r])}));return t}combineBboxAndFilter(e,t,r,i){const n=bboxFilterFn(e,t,r);return i?andFilterFn(i,n):n}writeTransaction(e,t,r,i){const n=[],o=i.version?i.version:this.version_,a=createElementNS(WFSNS[o],"Transaction");let s;a.setAttribute("service","WFS"),a.setAttribute("version",o),i&&(s=i.gmlOptions?i.gmlOptions:{},i.handle&&a.setAttribute("handle",i.handle)),a.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATIONS[o]);const p=createTransactionRequest(a,s,o,i);return e&&serializeTransactionRequest("Insert",e,n,p),t&&serializeTransactionRequest("Update",t,n,p),r&&serializeTransactionRequest("Delete",r,n,p),i.nativeElements&&serializeTransactionRequest("Native",i.nativeElements,n,p),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild)for(let t=(e=e.firstElementChild.firstElementChild).firstElementChild;t;t=t.nextElementSibling)if(0!==t.childNodes.length&&(1!==t.childNodes.length||3!==t.firstChild.nodeType)){const e=[{}];return this.gmlFormat_.readGeometryElement(t,e),getProjection(e.pop().srsName)}return null}}function createTransactionRequest(e,t,r,i){const n=i.featurePrefix?i.featurePrefix:FEATURE_PREFIX;let o;"1.0.0"===r?o=2:"1.1.0"===r?o=3:"2.0.0"===r&&(o=3.2);return Object.assign({node:e},{version:r,featureNS:i.featureNS,featureType:i.featureType,featurePrefix:n,gmlVersion:o,hasZ:i.hasZ,srsName:i.srsName},t)}function serializeTransactionRequest(e,t,r,i){pushSerializeAndPop(i,TRANSACTION_SERIALIZERS,makeSimpleNodeFactory(e),t,r)}function readTransactionSummary(e,t){return pushParseAndPop({},TRANSACTION_SUMMARY_PARSERS,e,t)}const OGC_FID_PARSERS={"http://www.opengis.net/ogc":{FeatureId:makeArrayPusher((function(e,t){return e.getAttribute("fid")}))},"http://www.opengis.net/ogc/1.1":{FeatureId:makeArrayPusher((function(e,t){return e.getAttribute("fid")}))}};function fidParser(e,t){parseNode(OGC_FID_PARSERS,e,t)}const INSERT_RESULTS_PARSERS={"http://www.opengis.net/wfs":{Feature:fidParser},"http://www.opengis.net/wfs/2.0":{Feature:fidParser}};function readInsertResults(e,t){return pushParseAndPop([],INSERT_RESULTS_PARSERS,e,t)}function writeFeature(e,t,r){const i=r[r.length-1],n=i.featureType,o=i.featureNS,a=i.gmlVersion,s=createElementNS(o,n);e.appendChild(s),2===a?GML2.prototype.writeFeatureElement(s,t,r):3===a?GML3.prototype.writeFeatureElement(s,t,r):GML32.prototype.writeFeatureElement(s,t,r)}function writeOgcFidFilter(e,t,r){const i=r[r.length-1].version,n=OGCNS[i],o=createElementNS(n,"Filter"),a=createElementNS(n,"FeatureId");o.appendChild(a),a.setAttribute("fid",t),e.appendChild(o)}function getTypeName(e,t){const r=(e=e||FEATURE_PREFIX)+":";return t.startsWith(r)?t:r+t}function writeDelete(e,t,r){const i=r[r.length-1];assert(void 0!==t.getId(),"Features must have an id set");const n=i.featureType,o=i.featurePrefix,a=i.featureNS,s=getTypeName(o,n);e.setAttribute("typeName",s),e.setAttributeNS(XMLNS,"xmlns:"+o,a);const p=t.getId();void 0!==p&&writeOgcFidFilter(e,p,r)}function writeUpdate(e,t,r){const i=r[r.length-1];assert(void 0!==t.getId(),"Features must have an id set");const n=i.version,o=i.featureType,a=i.featurePrefix,s=i.featureNS,p=getTypeName(a,o),l=t.getGeometryName();e.setAttribute("typeName",p),e.setAttributeNS(XMLNS,"xmlns:"+a,s);const d=t.getId();if(void 0!==d){const o=t.getKeys(),a=[];for(let e=0,r=o.length;e<r;e++){const r=t.get(o[e]);if(void 0!==r){let t=o[e];r&&"function"==typeof r.getSimplifiedGeometry&&(t=l),a.push({name:t,value:r})}}pushSerializeAndPop({version:n,gmlVersion:i.gmlVersion,node:e,hasZ:i.hasZ,srsName:i.srsName},TRANSACTION_SERIALIZERS,makeSimpleNodeFactory("Property"),a,r),writeOgcFidFilter(e,d,r)}}function writeProperty(e,t,r){const i=r[r.length-1],n=i.version,o=WFSNS[n],a=createElementNS(o,"Name"),s=i.gmlVersion;if(e.appendChild(a),writeStringTextNode(a,t.name),void 0!==t.value&&null!==t.value){const i=createElementNS(o,"Value");e.appendChild(i),t.value&&"function"==typeof t.value.getSimplifiedGeometry?2===s?GML2.prototype.writeGeometryElement(i,t.value,r):3===s?GML3.prototype.writeGeometryElement(i,t.value,r):GML32.prototype.writeGeometryElement(i,t.value,r):writeStringTextNode(i,t.value)}}function writeNative(e,t,r){t.vendorId&&e.setAttribute("vendorId",t.vendorId),void 0!==t.safeToIgnore&&e.setAttribute("safeToIgnore",String(t.safeToIgnore)),void 0!==t.value&&writeStringTextNode(e,t.value)}const GETFEATURE_SERIALIZERS={"http://www.opengis.net/wfs":{Query:makeChildAppender(writeQuery)},"http://www.opengis.net/wfs/2.0":{Query:makeChildAppender(writeQuery)},"http://www.opengis.net/ogc":{During:makeChildAppender(writeDuringFilter),And:makeChildAppender(writeLogicalFilter),Or:makeChildAppender(writeLogicalFilter),Not:makeChildAppender(writeNotFilter),BBOX:makeChildAppender(writeBboxFilter),Contains:makeChildAppender(writeSpatialFilter),Intersects:makeChildAppender(writeSpatialFilter),Within:makeChildAppender(writeSpatialFilter),DWithin:makeChildAppender(writeDWithinFilter),PropertyIsEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNotEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsLessThan:makeChildAppender(writeComparisonFilter),PropertyIsLessThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThan:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNull:makeChildAppender(writeIsNullFilter),PropertyIsBetween:makeChildAppender(writeIsBetweenFilter),PropertyIsLike:makeChildAppender(writeIsLikeFilter)},"http://www.opengis.net/fes/2.0":{During:makeChildAppender(writeDuringFilter),And:makeChildAppender(writeLogicalFilter),Or:makeChildAppender(writeLogicalFilter),Not:makeChildAppender(writeNotFilter),BBOX:makeChildAppender(writeBboxFilter),Contains:makeChildAppender(writeSpatialFilter),Disjoint:makeChildAppender(writeSpatialFilter),Intersects:makeChildAppender(writeSpatialFilter),ResourceId:makeChildAppender(writeResourceIdFilter),Within:makeChildAppender(writeSpatialFilter),DWithin:makeChildAppender(writeDWithinFilter),PropertyIsEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNotEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsLessThan:makeChildAppender(writeComparisonFilter),PropertyIsLessThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThan:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNull:makeChildAppender(writeIsNullFilter),PropertyIsBetween:makeChildAppender(writeIsBetweenFilter),PropertyIsLike:makeChildAppender(writeIsLikeFilter)}};function writeQuery(e,t,r){const i=r[r.length-1],n=i.version,o=i.featurePrefix,a=i.featureNS,s=i.propertyNames,p=i.srsName;let l,d;l=o?getTypeName(o,t):t,d="2.0.0"===n?"typeNames":"typeName",e.setAttribute(d,l),p&&e.setAttribute("srsName",p),a&&e.setAttributeNS(XMLNS,"xmlns:"+o,a);const m=Object.assign({},i);m.node=e,pushSerializeAndPop(m,QUERY_SERIALIZERS,makeSimpleNodeFactory("PropertyName"),s,r);const u=i.filter;if(u){const t=createElementNS(getFilterNS(n),"Filter");e.appendChild(t),writeFilterCondition(t,u,r)}}function writeFilterCondition(e,t,r){const i=r[r.length-1],n={node:e};Object.assign(n,{context:i}),pushSerializeAndPop(n,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory(t.getTagName()),[t],r)}function writeBboxFilter(e,t,r){const i=r[r.length-1],n=i.context.version;i.srsName=t.srsName;const o=GML_FORMATS[n];writePropertyName(n,e,t.geometryName),o.prototype.writeGeometryElement(e,t.extent,r)}function writeResourceIdFilter(e,t,r){e.setAttribute("rid",t.rid)}function writeSpatialFilter(e,t,r){const i=r[r.length-1],n=i.context.version;i.srsName=t.srsName;const o=GML_FORMATS[n];writePropertyName(n,e,t.geometryName),o.prototype.writeGeometryElement(e,t.geometry,r)}function writeDWithinFilter(e,t,r){const i=r[r.length-1].context.version;writeSpatialFilter(e,t,r);const n=createElementNS(getFilterNS(i),"Distance");writeStringTextNode(n,t.distance.toString()),"2.0.0"===i?n.setAttribute("uom",t.unit):n.setAttribute("units",t.unit),e.appendChild(n)}function writeDuringFilter(e,t,r){const i=r[r.length-1].context.version;writeExpression(FESNS[i],"ValueReference",e,t.propertyName);const n=createElementNS(GMLNS,"TimePeriod");e.appendChild(n);const o=createElementNS(GMLNS,"begin");n.appendChild(o),writeTimeInstant(o,t.begin);const a=createElementNS(GMLNS,"end");n.appendChild(a),writeTimeInstant(a,t.end)}function writeLogicalFilter(e,t,r){const i=r[r.length-1].context,n={node:e};Object.assign(n,{context:i});const o=t.conditions;for(let e=0,t=o.length;e<t;++e){const t=o[e];pushSerializeAndPop(n,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory(t.getTagName()),[t],r)}}function writeNotFilter(e,t,r){const i=r[r.length-1].context,n={node:e};Object.assign(n,{context:i});const o=t.condition;pushSerializeAndPop(n,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory(o.getTagName()),[o],r)}function writeComparisonFilter(e,t,r){const i=r[r.length-1].context.version;void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),writePropertyName(i,e,t.propertyName),writeLiteral(i,e,""+t.expression)}function writeIsNullFilter(e,t,r){writePropertyName(r[r.length-1].context.version,e,t.propertyName)}function writeIsBetweenFilter(e,t,r){const i=r[r.length-1].context.version,n=getFilterNS(i);writePropertyName(i,e,t.propertyName);const o=createElementNS(n,"LowerBoundary");e.appendChild(o),writeLiteral(i,o,""+t.lowerBoundary);const a=createElementNS(n,"UpperBoundary");e.appendChild(a),writeLiteral(i,a,""+t.upperBoundary)}function writeIsLikeFilter(e,t,r){const i=r[r.length-1].context.version;e.setAttribute("wildCard",t.wildCard),e.setAttribute("singleChar",t.singleChar),e.setAttribute("escapeChar",t.escapeChar),void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),writePropertyName(i,e,t.propertyName),writeLiteral(i,e,""+t.pattern)}function writeExpression(e,t,r,i){const n=createElementNS(e,t);writeStringTextNode(n,i),r.appendChild(n)}function writeLiteral(e,t,r){writeExpression(getFilterNS(e),"Literal",t,r)}function writePropertyName(e,t,r){"2.0.0"===e?writeExpression(FESNS[e],"ValueReference",t,r):writeExpression(OGCNS[e],"PropertyName",t,r)}function writeTimeInstant(e,t){const r=createElementNS(GMLNS,"TimeInstant");e.appendChild(r);const i=createElementNS(GMLNS,"timePosition");r.appendChild(i),writeStringTextNode(i,t)}export function writeFilter(e,t){const r=createElementNS(getFilterNS(t=t||"1.1.0"),"Filter"),i={node:r};return Object.assign(i,{version:t,filter:e}),writeFilterCondition(r,e,[i]),r}function writeGetFeature(e,t,r){const i=r[r.length-1],n=Object.assign({},i);n.node=e,pushSerializeAndPop(n,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory("Query"),t,r)}function getFilterNS(e){let t;return t="2.0.0"===e?FESNS[e]:OGCNS[e],t}export default WFS;
//# sourceMappingURL=/sm/f9afd720499e50c7d883f03a366af70b5d81daeab661b19b0929f1e00d6ea170.map