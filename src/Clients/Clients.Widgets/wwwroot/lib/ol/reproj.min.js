/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/ol@8.1.0/reproj.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{containsCoordinate,createEmpty,extend,forEachCorner,getCenter,getHeight,getTopLeft,getWidth}from"./extent.js";import{createCanvasContext2D,releaseCanvas}from"./dom.js";import{getPointResolution,transform}from"./proj.js";import{solveLinearSystem}from"./math.js";let brokenDiagonalRendering_;export const canvasPool=[];function drawTestTriangle(e,t,n,o,a){e.beginPath(),e.moveTo(0,0),e.lineTo(t,n),e.lineTo(o,a),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,o)+1,Math.max(n,a)),e.restore()}function verifyBrokenDiagonalRendering(e,t){return Math.abs(e[4*t]-210)>2||Math.abs(e[4*t+3]-191.25)>2}function isBrokenDiagonalRendering(){if(void 0===brokenDiagonalRendering_){const e=createCanvasContext2D(6,6,canvasPool);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(e,4,5,4,0),drawTestTriangle(e,4,5,0,5);const t=e.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(t,0)||verifyBrokenDiagonalRendering(t,4)||verifyBrokenDiagonalRendering(t,8),releaseCanvas(e),canvasPool.push(e.canvas)}return brokenDiagonalRendering_}export function calculateSourceResolution(e,t,n,o){const a=transform(n,t,e);let r=getPointResolution(t,o,n);const i=t.getMetersPerUnit();void 0!==i&&(r*=i);const s=e.getMetersPerUnit();void 0!==s&&(r/=s);const l=e.getExtent();if(!l||containsCoordinate(l,a)){const t=getPointResolution(e,r,a)/r;isFinite(t)&&t>0&&(r/=t)}return r}export function calculateSourceExtentResolution(e,t,n,o){const a=getCenter(n);let r=calculateSourceResolution(e,t,a,o);return(!isFinite(r)||r<=0)&&forEachCorner(n,(function(n){return r=calculateSourceResolution(e,t,n,o),isFinite(r)&&r>0})),r}export function render(e,t,n,o,a,r,i,s,l,c,g,u){const h=createCanvasContext2D(Math.round(n*e),Math.round(n*t),canvasPool);if(u||(h.imageSmoothingEnabled=!1),0===l.length)return h.canvas;function f(e){return Math.round(e*n)/n}h.scale(n,n),h.globalCompositeOperation="lighter";const d=createEmpty();l.forEach((function(e,t,n){extend(d,e.extent)}));const m=getWidth(d),v=getHeight(d),p=createCanvasContext2D(Math.round(n*m/o),Math.round(n*v/o),canvasPool);u||(p.imageSmoothingEnabled=!1);const T=n/o;l.forEach((function(e,t,n){const o=e.extent[0]-d[0],a=-(e.extent[3]-d[3]),r=getWidth(e.extent),i=getHeight(e.extent);e.image.width>0&&e.image.height>0&&p.drawImage(e.image,c,c,e.image.width-2*c,e.image.height-2*c,o*T,a*T,r*T,i*T)}));const x=getTopLeft(i);return s.getTriangles().forEach((function(e,t,a){const i=e.source,s=e.target;let l=i[0][0],c=i[0][1],g=i[1][0],m=i[1][1],v=i[2][0],T=i[2][1];const C=f((s[0][0]-x[0])/r),R=f(-(s[0][1]-x[1])/r),b=f((s[1][0]-x[0])/r),P=f(-(s[1][1]-x[1])/r),D=f((s[2][0]-x[0])/r),k=f(-(s[2][1]-x[1])/r),E=l,M=c;l=0,c=0,g-=E,m-=M,v-=E,T-=M;const y=solveLinearSystem([[g,m,0,0,b-C],[v,T,0,0,D-C],[0,0,g,m,P-R],[0,0,v,T,k-R]]);if(y){if(h.save(),h.beginPath(),isBrokenDiagonalRendering()||!u){h.moveTo(b,P);const e=4,t=C-b,n=R-P;for(let o=0;o<e;o++)h.lineTo(b+f((o+1)*t/e),P+f(o*n/(e-1))),o!=e-1&&h.lineTo(b+f((o+1)*t/e),P+f((o+1)*n/(e-1)));h.lineTo(D,k)}else h.moveTo(b,P),h.lineTo(C,R),h.lineTo(D,k);h.clip(),h.transform(y[0],y[2],y[1],y[3],C,R),h.translate(d[0]-E,d[3]-M),h.scale(o/n,-o/n),h.drawImage(p.canvas,0,0),h.restore()}})),releaseCanvas(p),canvasPool.push(p.canvas),g&&(h.save(),h.globalCompositeOperation="source-over",h.strokeStyle="black",h.lineWidth=1,s.getTriangles().forEach((function(e,t,n){const o=e.target,a=(o[0][0]-x[0])/r,i=-(o[0][1]-x[1])/r,s=(o[1][0]-x[0])/r,l=-(o[1][1]-x[1])/r,c=(o[2][0]-x[0])/r,g=-(o[2][1]-x[1])/r;h.beginPath(),h.moveTo(s,l),h.lineTo(a,i),h.lineTo(c,g),h.closePath(),h.stroke()})),h.restore()),h.canvas}
//# sourceMappingURL=/sm/e7de72d9359f5489a59ed550a351b3fd2ad95d43f587867631ffeb4e3162b51b.map